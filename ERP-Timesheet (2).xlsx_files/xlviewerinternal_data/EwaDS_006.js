(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1056:function(z,F,b){function a(Fa){var ab=this;Fa=void 0===Fa?null:Fa;this.NT=0;this.YP=null;this.Oyg=0;var Ua=da.a.Ae();this.nug=this.wih(Fa).then(function(bb){return bb?ab.Hdi():(v.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",ab.ov(),Math.floor(da.a.Ae()-Ua)),bb=ka.a.us(),void 0!==bb&&null!==bb&&(bb.set("AuthLibrary",ab.ov()),bb=Object.assign(new qa.a,
{durationMs:Math.floor(da.a.Ae()-Ua),extendedProperties:bb}),ra.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,bb)),Promise.resolve(1))}).then(function(bb){return 0!==bb?Promise.resolve(bb):ab.Dxi()})}function c(Fa){this.YRc=Fa;this.eZa="UnsupportedAuthTokenStrategy Reason="+t.a[this.YRc]}function e(){this.ht=null;this.DUb=0;this.ylb=this.rZa=this.FHc=this.MEa=this.TM=this.sme=null;this.Yv=new ba.a(null,null);this.jZb=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.eZa="SharedAuthTokenStrategy "+(this.jZb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.cZ=U.a.HAj;this.tke=U.a.GAj;this.l9d=U.a.enableConsoleLogging;this.Yrg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.wAg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.jZb);this.esa={};this.yug=new n(1500)}function l(Fa,ab,Ua,bb,xa,Gb,$b){var oa=
ia.call(this,!1,!1,!0)||this;oa.t2=null;oa.A8d=null;oa.cZ=Fa;oa.fyg=Ua;oa.Yv=bb;oa.ZBg=xa;oa.MEa=Gb;oa.ht=document.createElement("iframe");oa.ht.id="SharedAuthInteractiveFrame";oa.ht.setAttribute("name","SharedAuthInteractiveFrame");oa.ht.setAttribute("title","SharedAuthInteractiveFrame");oa.ht.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");oa.ht.style.border="0";oa.ht.style.height="48px";oa.ht.style.width="190px";$addHandler(oa.ht,"error",Object(ea.a)(oa,oa.rXi,
"onSharedAuthFrameError"));Fa=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",oa.cZ,ab,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",H.AFrameworkApplication.userType);$b&&(Fa+="&vnext=1");oa.ht.src=Fa;oa.Erg=new Promise(function(Ma){oa.A8d=Ma});oa.B8d=!1;return oa}function m(){this.correlationId=this.resolve=null}function n(Fa){Fa=void 0===Fa?0:Fa;this.iC=0;this.rmb=!1;this.Fm=new S.a;this._timeout=Fa}function h(){this.reject=this.resolve=null;this.startTime=
0;this.WNf=this.dxe=null}function u(){this.tne=null;var Fa=H.AFrameworkApplication.ha.Wa(H.AFrameworkApplication.kfa),ab=H.AFrameworkApplication.ha.Wa(H.AFrameworkApplication.ffg);this.eZa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",Fa&&""!==Fa?Fa:"Unspecified",ab&&""!==ab?ab:"Unspecified")}function w(Fa,ab,Ua,bb,xa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=Fa;this.scope=ab;this.silentLogin=Ua;this.options=
bb;this.correlationId=xa}function r(){}function B(Fa){this.zwg=Fa}function y(){}b.r(F);z=b(0);var v=b(13),A=b(903),t=b(1129),E;(function(Fa){Fa[Fa.external=0]="external";Fa[Fa.msa=1]="msa";Fa[Fa.aad=2]="aad"})(E||(E={}));Object(z.b)("AuthorityType",E);Object(z.a)(y,"OAuthResult",null,[]);B.prototype.initialize=function(){return Promise.resolve(0)};B.prototype.Slc=function(){return Promise.resolve(0)};B.prototype.sT=function(){v.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");
return Promise.resolve(Object.assign(new y,{IsSuccess:!0,Token:this.zwg}))};B.prototype.$Cc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};B.prototype.xBc=function(){return!1};B.prototype.Txb=function(){return"MockAuthTokenStrategy"};Object(z.a)(B,"MockAuthTokenStrategy",null,[898]);var C=b(1155);r.get=function(Fa,ab,Ua){if(!Ua)return Fa;
var bb=0;return Promise.race([Fa,new Promise(function(xa){bb=window.setTimeout(function(){xa(ab)},Ua)})]).then(function(xa){window.clearTimeout(bb);return Promise.resolve(xa)}).catch(function(){window.clearTimeout(bb);return Promise.resolve(ab)})};Object(z.a)(r,"PromiseWithTimeout",null,[]);var H=b(4),U=b(942);Object(z.a)(w,"TokenRequestParameters",null,[903]);var Q=b(23),O=b(84);u.prototype.initialize=function(){var Fa=this;return new Promise(function(ab){O.a.instance.qc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Ua){Fa.tne=
Ua;ab(0)})})};u.prototype.Gi=function(Fa){for(var ab=!1,Ua=Fa.toLocaleUpperCase(),bb=Cl(["HTTPS:","API:"]),xa=bb.next();!xa.done;xa=bb.next())if(Ua.startsWith(xa.value)){ab=!0;break}return ab||this.Oni(Fa)?Fa+"/.default":Fa};u.prototype.Oni=function(Fa){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(Fa)};u.prototype.Slc=function(){return Promise.resolve(0)};u.prototype.sT=function(Fa,ab,Ua,bb,xa,Gb,$b){if(Q.a.Yla){xa=U.a.d1j;if(!xa)return ab=Object.assign(new y,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(ab);if(!Array.contains(xa,Fa))return ab=Object.assign(new y,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+Fa}),Promise.resolve(ab)}Fa=this.Gi(Ua);Ua=new w(Ua,Fa,!bb,null,H.AFrameworkApplication.userSessionId);return this.tne.getAccessToken(Ua,ab,$b).then(function(oa){return Object.assign(new y,{IsSuccess:!0,Token:oa.accessToken})},function(oa){return Object.assign(new y,
{IsSuccess:!1,ErrorCode:oa})})};u.prototype.$Cc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};u.prototype.xBc=function(){return!1};u.prototype.Txb=function(){return this.eZa};Object(z.a)(u,"ParentFrameTokenStrategy",null,[898]);var ea=b(82),Z=b(1063),S=b(199);Object(z.a)(h,"PromiseWrapper",null,[]);n.prototype.enqueue=function(Fa){var ab=
this;return new Promise(function(Ua,bb){ab.Fm.add(Object.assign(new h,{WNf:Fa,resolve:Ua,reject:bb}));ab.process()})};n.prototype.process=function(){var Fa=this;if(this.rmb||this.iC===this.Fm.count)return!1;var ab=this.Fm.pa(this.iC++);try{this.rmb=!0,ab.WNf().then(function(Ua){Fa.rmb=!1;Fa.H4c(ab,Ua,null,!0)}).catch(function(Ua){Fa.rmb=!1;Fa.H4c(ab,null,Ua,!1)})}catch(Ua){this.rmb=!1,this.H4c(ab,null,Ua,!1)}return!0};n.prototype.H4c=function(Fa,ab,Ua,bb){var xa=this;bb?0<this._timeout?window.setTimeout(function(){Fa.resolve(ab);
xa.process()},this._timeout):(Fa.resolve(ab),xa.process()):0<this._timeout?window.setTimeout(function(){Fa.reject(Ua);xa.process()},this._timeout):(Fa.reject(Ua),xa.process())};Object(z.a)(n,"PromiseQueue",null,[]);Object(z.a)(m,"ResolveWithCorrelation",null,[]);var I=b(81),P=b(149),J=b(1036),aa=b(166),ia=P.a;Am(l,ia);l.prototype.Lzc=function(){var Fa={};Fa=(Fa.promptMessage=this.fyg,Fa.errorText=CommonUIStrings.l_InternalError,Fa.rtl=H.AFrameworkApplication.isRtl,Fa.frameLoaded=!1,Fa.createFrame=
Object(ea.a)(this,this.P$g,"createFrame"),Fa.resolveDialogStyles=this.A8d,Fa);var ab={};this.t2=(ab.id="SharedAuthConsentDialog",ab.bodyControls=Fa,ab);this.lc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ea.a)(this,this.FAj,"sharedAuthConsentDialogHandler"),this.t2)};l.prototype.Qhg=function(Fa,ab){var Ua=!0;Ua=void 0===Ua?!1:Ua;Fa=void 0===Fa?!1:Fa;ab=void 0===ab?5:ab;this.t2&&this.t2.bodyControls&&(Ua!==Object(I.a)(Object,this.t2.bodyControls).frameLoaded&&(Object(I.a)(Object,this.t2.bodyControls).frameLoaded=
Ua),Fa!==Object(I.a)(Object,this.t2.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.t2.bodyControls).frameLoadSuccess=Fa),ab!==this.t2.dialogButtonsOption&&(this.t2.dialogButtonsOption=null,this.lc=ab),this.update(this.t2))};l.prototype.aHj=function(Fa,ab){var Ua=new J.a(aa.a.JAj),bb={};Fa=(bb.signInLabel=CommonUIStrings.l_SignIn,bb.cancelLabel=CommonUIStrings.l_DialogCancel,bb.rtl=H.AFrameworkApplication.isRtl,bb.messageCorrelationId=Fa,bb.dialogStyles=ab,bb);Ua.Values=Fa;this.Yv.JSa(Ua,
this.ht.contentWindow,this.cZ)};l.prototype.XYe=function(){this.Qhg(!1,6)};l.prototype.rXi=function(){this.XYe()};l.prototype.P$g=function(){return this.ht};l.prototype.FAj=function(Fa){0===Fa&&(this.ZBg.reject(Object.assign(new y,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.MEa(null))};uk.Object.defineProperties(l.prototype,{p5f:{configurable:!0,enumerable:!0,get:function(){return this.ht}},jjh:{configurable:!0,enumerable:!0,get:function(){var Fa=
this;return this.Erg.then(function(ab){Fa.B8d=!0;return ab})}},kjh:{configurable:!0,enumerable:!0,get:function(){return this.B8d}}});Object(z.a)(l,"SharedAuthConsentDialog",P.a,[904]);var ba=b(1318),ra=b(99),ka=b(134),da=b(37),ha=b(186),qa=b(355);e.prototype.Txb=function(){return this.eZa};e.prototype.initialize=function(){var Fa=b(1056).OAuthManager;if("loadFrame"in this.esa)return this.esa.loadFrame.dxe;if(!this.cZ)return ra.Health.instance.recordKpiFailure(Fa.kpiName,"SharedAuthFrameOriginNotSet",
!1,!1,null),v.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);Fa=this.fBc("loadFrame");this.DUb=da.a.Ae();var ab=this.cZ+this.tke+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+H.AFrameworkApplication.userSessionId+"&WacUserType="+H.AFrameworkApplication.userType;this.jZb&&(ab+="&vnext=1");this.ht=document.createElement("iframe");this.nfi(this.ht);this.ht.style.cssText="height:0;width:0;display:none;";
this.ht.id="SharedAuthFrame";this.ht.setAttribute("name","SharedAuthFrame");this.ht.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.ht.setAttribute("title","SharedAuthFrame");this.ht.src=ab;document.body.appendChild(this.ht);ab=da.a.Ae()-this.DUb;v.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",ab,this.ht.src);return Fa};e.prototype.Slc=function(Fa){this.FHc=Fa;var ab=new J.a(aa.a.s5f);
ab.Values=this.Gwe(Fa);Fa=this.fBc("initFrame");this.Yv.JSa(ab,this.ht.contentWindow,this.cZ);v.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return Fa};e.prototype.sT=function(Fa,ab,Ua,bb,xa,Gb){var $b=this,oa=new J.a(aa.a.KAj),Ma=this.c6e();oa.Values=this.Beg(Fa,ab,Ua,bb,xa,Gb,Ma);Fa=this.fBc(Ma);bb&&H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.yug.enqueue(function(){return new Promise(function(Za){$b.NSj(Gb,
oa,Za,Ma)})}):(this.Yv.JSa(oa,this.ht.contentWindow,this.cZ),v.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",ab));return Fa};e.prototype.NSj=function(Fa,ab,Ua,bb){var xa=this.esa[bb];xa&&(this.rZa=ab,this.MEa=Object.assign(new m,{resolve:Ua,correlationId:bb}),this.TM=new l(this.cZ,this.tke,Fa,this.Yv,xa,Ua,this.jZb),this.TM.Lzc())};e.prototype.c6e=function(){return ha.a.create().toString()};e.prototype.Beg=function(Fa,ab,Ua,bb,xa,Gb,$b){var oa=
{};oa.appName=Fa;oa.appId=ab;oa.target=Ua;oa.withPopup=bb;oa.claims=xa;oa.promptMessage=Gb;oa.messageCorrelationId=$b;return oa};e.prototype.nfi=function(Fa){$addHandler(Fa,"load",Object(ea.a)(this,this.pSi,"onIFrameLoaded"));$addHandler(Fa,"error",Object(ea.a)(this,this.wpc,"onIFrameError"));this.Yv.AGa(this.cZ);this.Yv.mo(aa.a.v5f);this.Yv.Vl(aa.a.v5f,Object(ea.a)(this,this.LWi,"onScriptLoaded"));this.Yv.mo(aa.a.u5f);this.Yv.Vl(aa.a.u5f,Object(ea.a)(this,this.KWi,"onScriptInitialized"));this.Yv.mo(aa.a.q5f);
this.Yv.Vl(aa.a.q5f,Object(ea.a)(this,this.TRi,"onGetTokenResponse"));this.Yv.mo(aa.a.w5f);this.Yv.Vl(aa.a.w5f,Object(ea.a)(this,this.KTi,"onLoginResponse"));this.Yv.mo(aa.a.t5f);this.Yv.Vl(aa.a.t5f,Object(ea.a)(this,this.KSi,"onInteractiveFlowReady"));this.Yv.mo(aa.a.r5f);this.Yv.Vl(aa.a.r5f,Object(ea.a)(this,this.iSi,"onHideDialog"));this.Yv.mo(aa.a.o5f);this.Yv.Vl(aa.a.o5f,Object(ea.a)(this,this.qNi,"onCloseDialog"))};e.prototype.fBc=function(Fa){var ab=new h;ab.startTime=da.a.Ae();var Ua=new Promise(function(bb,
xa){ab.resolve=bb;ab.reject=xa});ab.dxe=Ua;this.esa[Fa]=ab;return Ua};e.prototype.pSi=function(){var Fa=da.a.Ae()-this.DUb;v.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",Fa)};e.prototype.wpc=function(Fa){var ab=b(1056).OAuthManager,Ua=da.a.Ae()-this.DUb,bb=Object.assign(new qa.a,{durationMs:Ua});ra.Health.instance.recordKpiFailure(ab.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,bb);v.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",
Ua,this.l9d?JSON.stringify(Fa):"")};e.prototype.LWi=function(Fa){var ab=b(1056).OAuthManager,Ua=this.esa.loadFrame,bb=da.a.Ae()-Ua.startTime,xa=Fa.Values.AuthLibrary.toString();Fa=Fa.Values.Success.toString();v.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",Fa,xa,bb);xa&&(this.eZa="SharedAuthTokenStrategy "+xa);xa=Boolean.parse(Fa);xa||(Fa=ka.a.us(),void 0!==Fa&&null!==Fa&&(Fa.set("AuthLibrary",this.Txb()),bb=Object.assign(new qa.a,
{durationMs:bb,extendedProperties:Fa}),ra.Health.instance.recordKpiFailure(ab.kpiName,"SharedAuthStrategyInitFailed",!1,!0,bb)));Ua.resolve(xa?0:1)};e.prototype.KWi=function(Fa){var ab=this;if(Fa.Values.interactive&&this.rZa&&this.rZa.Values.messageCorrelationId){var Ua=this.rZa.Values.messageCorrelationId.toString();if(Fa.Values.interactive&&this.TM){this.TM.jjh.then(function(xa){ab.Yv.JSa(ab.rZa,ab.TM.p5f.contentWindow,ab.cZ);ab.TM.aHj(Ua,xa);ab.TM.Qhg(!0);ab.rZa=null});return}}Fa=this.esa.initFrame;
var bb=da.a.Ae()-Fa.startTime;v.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",bb);Fa.resolve(0)};e.prototype.TRi=function(Fa){if(Fa.Values.messageCorrelationId&&Fa.Values.messageCorrelationId.toString()){var ab=Fa.Values.messageCorrelationId.toString(),Ua=this.esa[ab];if(Ua){var bb=da.a.Ae()-Ua.startTime;v.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",bb);Fa.Values.isSuccess&&Fa.Values.isSuccess?Ua.resolve(Fa.Values.response):
Ua.reject(Fa.Values.response);this.Qeg(ab)}else v.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else v.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};e.prototype.KSi=function(){if(this.TM.kjh)this.TM.XYe();else if(this.FHc&&this.TM){var Fa=new J.a(aa.a.s5f);Fa.Values=this.Gwe(this.FHc,!0);this.Yv.JSa(Fa,this.TM.p5f.contentWindow,this.cZ)}};
e.prototype.iSi=function(){this.TM&&this.TM.bzb()};e.prototype.qNi=function(Fa){Fa.Values.cancelled&&Fa.Values.cancelled&&Fa.Values.messageCorrelationId&&this.Qeg(Fa.Values.messageCorrelationId.toString());this.TM&&this.TM.hide()};e.prototype.Gwe=function(Fa,ab){ab=void 0===ab?!1:ab;var Ua={};Ua.appIds=this.wOh();Ua.upn=Fa.loginHint;Ua.authority=Fa.authority;Ua.authorityType=Object(A.a)(E,Fa.authorityType);Ua.tenantId=Fa.tenantId;Ua.correlationId=H.AFrameworkApplication.userSessionId;Ua.enableConsoleLogging=
this.l9d;Ua.enablePopupFlash=this.Yrg;Ua.skipUpnCheck=this.wAg;Ua.interactive=ab;return Ua};e.prototype.wOh=function(){var Fa=[],ab=U.a.ZYc,Ua;for(Ua in ab)Array.add(Fa,ab[Ua]);return Fa};e.prototype.$Cc=function(Fa,ab,Ua,bb,xa,Gb){var $b=new J.a(aa.a.IAj),oa=this.c6e();$b.Values=this.Beg(Fa,ab,Ua,bb,xa,Gb,oa);this.sme=$b;Fa=this.fBc(oa);v.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",ab);this.EEj();return Fa};e.prototype.xBc=function(){return!0};
e.prototype.EEj=function(){var Fa=this;this.ylb||(this.ylb=new Z.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.ylb.id=16,this.ylb.ijf=!1,this.ylb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){v.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");Fa.Yv.JSa(Fa.sme,Fa.ht.contentWindow,Fa.cZ)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),v.ULS.sendTraceTag(555049438,
3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};e.prototype.KTi=function(Fa){if(Fa.Values.messageCorrelationId&&Fa.Values.messageCorrelationId.toString()){var ab=this.esa[Fa.Values.messageCorrelationId.toString()];if(ab){var Ua=da.a.Ae()-ab.startTime;v.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Ua);Fa.Values.isSuccess&&Fa.Values.isSuccess?ab.resolve(Fa.Values.response):ab.reject(Fa.Values.response)}else v.ULS.sendTraceTag(555049440,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else v.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};e.prototype.Qeg=function(Fa){this.MEa&&this.MEa.correlationId===Fa&&(this.MEa.resolve(null),this.MEa=null)};Object(z.a)(e,"SharedAuthTokenStrategy",null,[898]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.Slc=function(){return Promise.resolve(0)};
c.prototype.sT=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:t.a[this.YRc],ErrorMessage:"Unable to get a token. Reason: ["+t.a[this.YRc]+"]"}))};c.prototype.$Cc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.xBc=function(){return!1};c.prototype.Txb=function(){return this.eZa};Object(z.a)(c,
"UnsupportedAuthTokenStrategy",null,[898]);var Aa=b(930);b.d(F,"OAuthManager",function(){return a});a.prototype.xih=function(){var Fa=U.a.ZFi;Fa&&0<Fa.length?(this.NT=1,this.YP=new B(Fa)):H.AFrameworkApplication.ha.ra("IsO365ConsumerHost")||H.AFrameworkApplication.ha.ra("IsO365CommercialHost")?H.AFrameworkApplication.ha.ra("IsAnonymousUser")?(this.NT=2,this.YP=new c(this.NT)):(Fa=C.a.getAuthContext().loginHint)&&Fa.length?U.a.gzb?(this.NT=1,this.YP=new u):(this.NT=1,this.YP=new e):(this.NT=3,this.YP=
new c(this.NT)):(this.NT=4,this.YP=new c(this.NT))};a.prototype.ov=function(){return this.YP?this.YP.Txb()||"Unknown":"None"};a.prototype.wih=function(Fa){var ab=this;Fa=void 0===Fa?null:Fa;v.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Ua=da.a.Ae();return H.AFrameworkApplication.ha.Ohd().then(function(bb){bb?(ab.xih(),Fa&&(ab.YP=Fa),v.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
U.a.clientVersion,U.a.appVersion,U.a.Dlh,ab.ov(),Math.floor(da.a.Ae()-Ua))):v.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(da.a.Ae()-Ua));return Promise.resolve(bb)},function(){v.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(da.a.Ae()-Ua));return Promise.resolve(!1)})};
a.prototype.Hdi=function(){var Fa=this;v.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.ov());var ab=da.a.Ae();return r.get(this.YP.initialize(),2,U.a.WId).then(function(Ua){if(0===Ua)v.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",Fa.ov(),Math.floor(da.a.Ae()-ab));else if(1===Ua){v.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab));var bb=ka.a.us();void 0!==
bb&&null!==bb&&(bb.set("AuthLibrary",Fa.ov()),bb=Object.assign(new qa.a,{durationMs:Math.floor(da.a.Ae()-ab),extendedProperties:bb}),ra.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,bb))}else 2===Ua&&(v.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab)),bb=ka.a.us(),void 0!==bb&&null!==bb&&(bb.set("AuthLibrary",Fa.ov()),bb=Object.assign(new qa.a,{durationMs:Math.floor(da.a.Ae()-
ab),extendedProperties:bb}),ra.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,bb)));return Promise.resolve(Ua)},function(){v.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab));return Promise.resolve(1)})};a.prototype.Dxi=function(){var Fa=this;v.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.ov());var ab=da.a.Ae();return r.get(this.YP.Slc(C.a.getAuthContext()),2,
U.a.WId).then(function(Ua){if(0===Ua)v.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",Fa.ov(),Math.floor(da.a.Ae()-ab));else if(1===Ua){v.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab));var bb=ka.a.us();void 0!==bb&&null!==bb&&(bb.set("AuthLibrary",Fa.ov()),bb=Object.assign(new qa.a,{durationMs:Math.floor(da.a.Ae()-ab),extendedProperties:bb}),ra.Health.instance.recordKpiFailure(a.kpiName,
"StrategyLoadFailed",!1,!0,bb))}else 2===Ua&&(v.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab)),bb=ka.a.us(),void 0!==bb&&null!==bb&&(bb.set("AuthLibrary",Fa.ov()),bb=Object.assign(new qa.a,{durationMs:Math.floor(da.a.Ae()-ab),extendedProperties:bb}),ra.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,bb)));return Promise.resolve(Ua)},function(){v.ULS.sendTraceTag(562128584,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Fa.ov(),Math.floor(da.a.Ae()-ab));return Promise.resolve(1)})};a.prototype.sT=function(Fa,ab,Ua){return this.YCc(Fa,ab,!1,null,"",void 0===Ua?null:Ua)};a.prototype.Ceg=function(Fa,ab,Ua,bb,xa){return this.YCc(Fa,ab,!0,Ua,bb,void 0===xa?null:xa)};a.prototype.YCc=function(Fa,ab,Ua,bb,xa,Gb,$b){$b=void 0===$b?0:$b;$b+=1;v.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",
Fa,this.uSa(Fa,ab),this.ov(),$b);var oa=ka.a.us();void 0!==oa&&null!==oa&&(oa.set("AuthLibrary",this.ov()),oa.set("AppName",Fa),oa.set("Target",this.uSa(Fa,ab)),ra.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",oa));if(!U.a.isEnabled){var Ma;return this.kxd((Ma=new y,Ma.IsSuccess=!1,Ma.Token=null,Ma.ErrorCode="NotEnabled",Ma.ErrorMessage="OAuthManager is disabled.",Ma),Fa)}var Za=U.a.ZYc[Fa];if(void 0===Za||null===Za){v.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",
Fa);var gb;return this.kxd((gb=new y,gb.IsSuccess=!1,gb.Token=null,gb.ErrorCode="DisallowedApp",gb.ErrorMessage="Disallowed appName: "+Fa,gb),Fa)}var zb=da.a.Ae(),nb=this;oa=this.nug.then(function(ib){return nb.vji(Fa,Za,ab,Ua,bb,xa,Gb,ib)});Ma=Ua?0:U.a.WId;var pa;gb=(pa=new y,pa.IsSuccess=!1,pa.Token=null,pa.ErrorCode="authTokenStrategy_timeout",pa.ErrorMessage="Auth Strategy timed out after ["+Ma+"] ms when fetching token",pa);var Ja=this,Da=this;return r.get(oa,gb,Ma).then(function(ib){return $b<=
a.rEi&&(ib.ErrorCode===a.Qcg||ib.ErrorCode===a.FLj)?(v.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",$b,Math.floor(da.a.Ae()-zb)),Ja.YCc(Fa,ab,Ua,bb,xa,Gb,$b)):ib.ErrorCode===a.Emf&&!Ua&&(v.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",$b,a.POe),a.aph&&Ja.YP.xBc()&&Ja.YP.$Cc(Fa,Za,ab,Ua,bb,xa).then(function(Rb){return Promise.resolve(Ja.kmc(Rb,Fa,ab,Za,zb))}).catch(function(){var Rb,
wc=(Rb=new y,Rb.IsSuccess=!1,Rb.Token=null,Rb.ErrorCode="authTokenStrategy_failure",Rb.ErrorMessage="LoginPopup failed, GetToken could not be called",Rb);return Promise.resolve(Ja.kmc(wc,Fa,ab,Za,zb))}),a.POe)?Ja.YCc(Fa,ab,!0,bb,xa,Gb,$b):Promise.resolve(Ja.kmc(ib,Fa,ab,Za,zb))}).catch(function(){var ib,Rb=(ib=new y,ib.IsSuccess=!1,ib.Token=null,ib.ErrorCode="authTokenStrategy_failure",ib.ErrorMessage="Auth Strategy failed with an unknown error",ib);return Promise.resolve(Da.kmc(Rb,Fa,ab,Za,zb))})};
a.prototype.vji=function(Fa,ab,Ua,bb,xa,Gb,$b,oa){var Ma=this;return 1===oa||2===oa?this.kxd(Object.assign(new y,{IsSuccess:!1,Token:null,ErrorCode:1===oa?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),Fa):this.YP.sT(Fa,ab,Ua,bb,xa,Gb,$b).then(function(Za){return Promise.resolve(Ma.jwf(Za,!0,Fa))}).catch(function(Za){return Promise.resolve(Ma.jwf(Za,!1,Fa))})};a.prototype.kmc=function(Fa,ab,Ua,bb,xa){var Gb={};xa=da.a.Ae()-xa;Gb.IsSuccess=Fa.IsSuccess;Gb.ErrorCode=
Fa.IsSuccess?"Success":Fa.ErrorCode||"";Gb.ErrorMessage=Fa.IsSuccess?"Success":this.uSa(ab,Fa.ErrorMessage||"");Gb.Target=this.uSa(ab,Ua||"");Gb.TimeInMS=Math.floor(xa);Gb.AuthLibrary=this.ov();Gb.AppName=ab;Gb.AuthorityType=Object(A.a)(E,C.a.acc());Gb.UserType=this.k5h(C.a.getAuthContext());Gb.IsAuthSupportedInSession=t.a[this.NT];Gb.RequestCount=++this.Oyg;Gb.AppId=bb;v.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(Gb));Fa.IsSuccess||(Ua=ka.a.us(),void 0!==Ua&&null!==Ua&&(Ua.set("AppName",ab),
Ua.set("AuthLibrary",this.ov()),Ua.set("ErrorCode",Fa.ErrorCode),Ua.set("ErrorMessage",this.uSa(ab,Fa.ErrorMessage)),ab=Object.assign(new qa.a,{durationMs:xa,extendedProperties:Ua}),ra.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,ab)));return Fa};a.prototype.kxd=function(Fa,ab){v.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",ab,this.uSa(ab,Fa.ErrorMessage));var Ua=ka.a.us();void 0!==Ua&&null!==Ua&&(Ua.set("AppName",
ab),Ua.set("AuthLibrary",this.ov()),Ua.set("ErrorCode",Fa.ErrorCode),Ua.set("ErrorMessage",this.uSa(ab,Fa.ErrorMessage)),ab=Object.assign(new qa.a,{extendedProperties:Ua}),ra.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,ab));return Promise.resolve(Fa)};a.prototype.Qhf=function(Fa){return Fa===Aa.a.kCc};a.prototype.uSa=function(Fa,ab){return this.Qhf(Fa)&&ab?"REDACTED":ab};a.prototype.k5h=function(Fa){return H.AFrameworkApplication.ha.ra("IsAnonymousUser")?"anonymous":!Fa.loginHint||
1>Fa.loginHint.length?"empty":-1<Fa.loginHint.indexOf("guest#")?"guest":-1<Fa.loginHint.indexOf("ext#")?"external":0>Fa.upn.indexOf("@")?"no-at":"supported"};a.prototype.Ixa=function(){return 1===this.NT};a.prototype.jwf=function(Fa,ab,Ua){var bb=null,xa=null,Gb=null,$b=null;Fa?Fa.ErrorCode||Fa.ErrorMessage?(xa=Fa.ErrorCode?Fa.ErrorCode:a.hVe,Gb=Fa.ErrorMessage?Fa.ErrorMessage:"No message"):Fa.Token?ab?bb=Fa.Token:(xa=a.Ydj,Gb="A rejected promise returned a token."):(xa=a.hVe,Gb=JSON.stringify(Fa)):
(xa=a.BIi,Gb="No result came from Auth Token Strategy");Fa&&Fa.Telemetry&&!this.Qhf(Ua)&&($b=Fa.Telemetry,v.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify($b)));if(xa===a.kGi||xa===a.sQj)xa=a.Qcg,Gb="Auth Library Timed Out";xa===a.PQg&&-1<Gb.indexOf(a.PCg)&&(xa=a.Emf);if(xa||Gb)bb=null;return Object.assign(new y,{IsSuccess:!!bb,Token:bb,ErrorCode:xa,ErrorMessage:Gb,Telemetry:$b})};uk.Object.defineProperties(a,{POe:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",
!1)}},aph:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.sQj="token_renewal_error";a.hVe="Exception";a.BIi="NoResult";a.Ydj="RejectToken";a.kGi="monitor_window_timeout";a.Qcg="Timeout";a.FLj="authTokenStrategy_timeout";a.PQg="login_required";a.PCg="AADSTS50058";a.Emf="Cookies Disabled";a.kpiName="OAuthManager";a.rEi=2;Object(z.a)(a,"OAuthManager",null,[727])},1129:function(z,F,b){b.d(F,
"a",function(){return a});z=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(z.b)("SupportStatus",a)},1466:function(z,F,b){function a(Z){var S=ea.call(this)||this;S.$=Z;S.Xb();return S}function c(Z){this.oAuthManager=Z}function e(){}function l(Z){this.iWb=Z}function m(){}function n(){}b.r(F);
z=b(0);var h=b(13),u=b(1056),w=b(1129),r=b(4),B=b(99),y=b(942),v=b(254),A=b(37),t=b(23),E=b(84),C=b(355);n.prototype.hi=function(Z){Z.register(727,"Common.App.OAuth.IOAuthManager").Ic().Nc(function(){return new u.OAuthManager})};n.prototype.init=function(){var Z=E.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.xTj(Z)};n.prototype.xTj=function(Z){var S=r.AFrameworkApplication.ha.Wa("FileSource");if(r.AFrameworkApplication.ha.ra("IsO365ConsumerHost")||r.AFrameworkApplication.ha.ra("IsO365CommercialHost")||
"WopiTest"===S){var I=y.a.FKh,P=y.a.authority;if(void 0!==I&&null!==I&&I.length&&void 0!==P&&null!==P&&P.length){var J=w.a[Z.NT],aa=t.a.FHa,ia=Z.ov();try{var ba=new Map;void 0!==ba&&null!==ba?(ba.set("SupportStatus",J),ba.set("Browser",aa),ba.set("AuthStrategy",ia)):ba=null}catch(ka){ba=null}B.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",ba);var ra=A.a.Ae();Z.sT("Core",I).then(function(ka){var da=Math.floor(A.a.Ae()-ra);J=w.a[Z.NT];aa=t.a.FHa;ia=Z.ov();h.ULS.sendTraceTag(562943369,
3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',da,ka.IsSuccess,J,ka.ErrorCode,S,aa,ia);ba&&(ba.set("SupportStatus",J),ba.set("Browser",aa),ba.set("AuthStrategy",ia));da=Object.assign(new C.a,{durationMs:da,extendedProperties:ba});ka.IsSuccess?B.Health.instance.recordKpiSuccess("WacCorePFT",da):B.Health.instance.recordKpiFailure("WacCorePFT",ka.ErrorCode,!1,!1,da)})}}};
n.prototype.dispose=function(){};n.main=function(){v.a.instance.nj(new n)};uk.Object.defineProperties(n.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(z.a)(n,"OAuthPackage",null,[4,5]);var H=b(1155);Object(z.a)(m,"LokiTokenResult",null,[]);l.prototype.Did=function(){var Z=this,S=this.RXh();return S?l.Fsd?new Promise(function(I,P){Z.iWb.continueWith(function(){Z.iWb.Ph||Z.iWb.og?P(Error.create("Error downloading auth library")):Z.iWb.result.sT("Loki",
S).then(function(J){J=r.AFrameworkApplication.ha.ra("ForceLokiFallbackToACLPTokenIsEnabled")?Z.UXh():J.IsSuccess&&J.Token?Object.assign(new m,{isSuccess:!0,token:J.Token,errorMessage:null}):Object.assign(new m,{isSuccess:!1,token:null,errorMessage:JSON.stringify(J)});I(J);return J})})}):Promise.resolve(Object.assign(new m,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new m,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",
H.a.e0e())}))};l.prototype.UXh=function(){var Z=r.AFrameworkApplication.ha.Wa("LokiUserDataSignature")||"";return Object.assign(new m,{isSuccess:!0,token:Z,errorMessage:null})};l.prototype.RXh=function(){var Z=null,S=H.a.acc();2===S?Z=r.AFrameworkApplication.ha.Wa("LokiAADAppId"):1===S&&(Z=r.AFrameworkApplication.ha.Wa("LokiMSAAppId"));return Z};uk.Object.defineProperties(l,{Fsd:{configurable:!0,enumerable:!0,get:function(){return r.AFrameworkApplication.ha.ra("IsO365CommercialHost")||r.AFrameworkApplication.ha.ra("IsO365ConsumerHost")}}});
Object(z.a)(l,"LokiTokenManager",null,[769]);var U=b(565);e.prototype.init=function(){E.a.instance.resolve("Common.ILokiTokenManager")};e.prototype.dispose=function(){};e.prototype.hi=function(Z){Z.register(l,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Ic().Nc(function(){return new l(U.a.lr(Z.qc("Common.App.OAuth.IOAuthManager")))})};e.main=function(){v.a.instance.nj(new e)};uk.Object.defineProperties(e.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});
Object(z.a)(e,"LivePersonaUtilsPackage",null,[4,5]);var Q=b(10);F=b(224);var O=b(1024);c.prototype.sT=function(Z,S){return this.oAuthManager?this.oAuthManager.sT(Z,S).then(function(I){I.IsSuccess||h.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+I.ErrorMessage+" Error code: "+I.ErrorCode+" App name: "+Z);return Object.assign(new O.a,{IsSuccess:I.IsSuccess,Token:I.Token,ErrorCode:I.ErrorCode,ErrorMessage:I.ErrorMessage})}):(h.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),
Promise.resolve(Object.assign(new O.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.Ixa=function(){return this.oAuthManager?this.oAuthManager.Ixa():null};Object(z.a)(c,"OAuthManagerWrapper",null,[764]);var ea=F.a;Am(a,ea);a.prototype.create=function(){this.Eb(this.$.da.Aa(349)||new c(E.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ka=function(Z){Z.da.Ha(350,new a(Z))};Object(z.a)(a,"OAuthManagerFactory",
F.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");n.main();Type.registerNamespace("Common.App.LivePersonaUtils");e.main();(function(){Q.a.Ga(function(Z){a.ka(Z)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/085e29c59be395b0606ed171295ff180/EwaDS.oauth.js.map