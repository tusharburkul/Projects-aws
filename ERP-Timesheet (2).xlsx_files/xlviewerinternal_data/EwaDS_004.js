(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1003:function(z,F,b){function a(){}b.d(F,"a",function(){return a});z=b(0);a.abs="Abs";a.rel="Rel";Object(z.a)(a,"PositionBaseType",null,[])},1015:function(z,F,b){function a(H){this.calcManager=H}function c(){return w.call(this)||this}function e(){this.hxc=this.firstRow=null;return this}function l(){return w.call(this)||this}function m(){this.right=this.left=this.bottom=this.top=null;return this}function n(){return w.call(this)||
this}function h(){this.gxc=this.firstColumn=null;return this}function u(){var H=w.call(this)||this;H.zjc=!1;return H}function w(){this.end=this.start=0;this.Fv=null}function r(){this.column=this.row=null;return this}function B(){}b.r(F);z=b(0);var y=b(13);Object(z.a)(B,"Reference",null,[]);Am(r,B);Object(z.a)(r,"CellReference",B,[]);w.prototype.wOg=function(H,U){for(var Q=0;Q<this.Fv.length;Q++){var O=this.n1b(H,this.Fv[Q]);U+=O;Q<this.Fv.length-1&&(U+=":")}return U};Object(z.a)(w,"IReferenceSequence",
null,[]);var v=b(24),A=b(1003);Am(u,w);u.prototype.Edc=function(){var H=b(1015).RelativeAndAbsoluteReferencesManager,U=this.Fv[0];return H.Wvf(U.row.kind===A.a.abs,U.column.kind===A.a.abs)};u.prototype.n1b=function(H,U){U=v.Range.kd(U.row.index+1,U.column.index+1);return this.zjc?U.Pcc(1===H||3===H,1===H||2===H):U.F5a(1===H||3===H,1===H||2===H,!0,!0)};Object(z.a)(u,"CellReferenceSequence",w,[]);Am(h,B);Object(z.a)(h,"ColumnReference",B,[]);Am(n,w);n.prototype.Edc=function(){var H=this.Fv[0];return b(1015).RelativeAndAbsoluteReferencesManager.suf(H.firstColumn,
H.gxc).kind===A.a.abs?2:3};n.prototype.n1b=function(H,U){return v.Range.hwb(U.firstColumn.index+1,U.gxc.index+1).F5a(1===H||3===H,!0,1===H||3===H,!0)};Object(z.a)(n,"ColumnReferenceSequence",w,[]);Am(m,B);Object(z.a)(m,"RangeReference",B,[]);Am(l,w);l.prototype.Edc=function(){var H=b(1015).RelativeAndAbsoluteReferencesManager,U=this.Fv[0];return H.Wvf(U.top.kind===A.a.abs,U.left.kind===A.a.abs)};l.prototype.n1b=function(H,U){U=new v.Range(U.top.index+1,U.left.index+1,U.bottom.index+1,U.right.index+
1,!1,!1);var Q=1===H||3===H;H=1===H||2===H;return U.F5a(Q,H,Q,H)};Object(z.a)(l,"RangeReferenceSequence",w,[]);Am(e,B);Object(z.a)(e,"RowReference",B,[]);Am(c,w);c.prototype.Edc=function(){var H=this.Fv[0];return b(1015).RelativeAndAbsoluteReferencesManager.suf(H.firstRow,H.hxc).kind===A.a.abs?0:1};c.prototype.n1b=function(H,U){return v.Range.Cbc(U.firstRow.index+1,U.hxc.index+1).F5a(!0,1===H||2===H,!0,1===H||2===H)};Object(z.a)(c,"RowReferenceSequence",w,[]);var t=b(1203),E=b(1204),C=b(203);b.d(F,
"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.v2a=function(H,U,Q){var O=U;var ea=Q;if(!H||!C.e(H))return{returnValue:H,XAd:O,WAd:ea};var Z=this.calcManager.YVe(H);if(!Z)return y.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,XAd:O,WAd:ea};Z=this.Y1h(Z,H,U,Q);for(var S=0,I="",P=0,J=0;J<Z.length;J++)if(this.aNe(Z[J],U,Q)){S=Z[J].Edc();
O=Z[J].start;break}for(;J<Z.length&&this.aNe(Z[J],U,Q);J++)I+=H.substring(P,Z[J].start),I=Z[J].wOg(S,I),P=Z[J].end;P&&(ea=I.length);I+=H.substring(P,H.length);return{returnValue:I,XAd:O,WAd:ea}};a.prototype.Y1h=function(H,U,Q,O){for(var ea=[],Z=0;Z<H.length;Z++){var S=H[Z];if(S.kind===t.a.range)if(S=S.ref,S.type===E.a.cell){var I=S;S=Object.assign(new u,{start:S.span.start,end:S.span.end,Fv:[Object.assign(new r,{column:I.col,row:I.row})],zjc:this.calcManager.D3b(S.span.end,U)});ea.push(S)}else if(S.type===
E.a.range)this.bNe(S.topLeftSpan,Q,O)&&this.bNe(S.bottomRightSpan,Q,O)?(I=new m,S.top.index<=S.bottom.index?(I.top=S.top,I.bottom=S.bottom):(I.bottom=S.top,I.top=S.bottom),S.left.index<=S.right.index?(I.left=S.left,I.right=S.right):(I.right=S.left,I.left=S.right),S=Object.assign(new l,{start:S.topLeftSpan.start,end:S.bottomRightSpan.end,Fv:[I]}),ea.push(S)):(I=Object.assign(new u,{start:S.topLeftSpan.start,end:S.topLeftSpan.end,Fv:[Object.assign(new r,{column:S.left,row:S.top})],zjc:this.calcManager.D3b(S.topLeftSpan.end,
U)}),S=Object.assign(new u,{start:S.bottomRightSpan.start,end:S.bottomRightSpan.end,Fv:[Object.assign(new r,{column:S.right,row:S.bottom})],zjc:this.calcManager.D3b(S.topLeftSpan.end,U)}),ea.push(I),ea.push(S));else if(S.type===E.a.column){I=S;for(S=Object.assign(new n,{start:S.span.start,end:S.span.end,Fv:[Object.assign(new h,{firstColumn:I.startIndex,gxc:I.endIndex})]});S.end<U.length-1&&":"===U.charAt(S.end)&&Z<H.length-1;)if(I=H[Z+1].ref,I.type===E.a.column&&I.span.start===S.end+1){var P=I;S.Fv.push(Object.assign(new h,
{firstColumn:P.startIndex,gxc:P.endIndex}));S.end=I.span.end;Z++}else break;ea.push(S)}else if(S.type===E.a.row){I=S;for(S=Object.assign(new c,{start:S.span.start,end:S.span.end,Fv:[Object.assign(new e,{firstRow:I.startIndex,hxc:I.endIndex})]});S.end<U.length-1&&":"===U.charAt(S.end)&&Z<H.length-1;)if(I=H[Z+1].ref,I.type===E.a.row&&I.span.start===S.end+1)P=I,S.Fv.push(Object.assign(new e,{firstRow:P.startIndex,hxc:P.endIndex})),S.end=I.span.end,Z++;else break;ea.push(S)}}return ea};a.prototype.aNe=
function(H,U,Q){return!(H.start>Q||U>H.end)};a.prototype.bNe=function(H,U,Q){return!(H.start>Q||U>H.end)};a.suf=function(H,U){return H.index<=U.index?H:U};a.Wvf=function(H,U){return U||H?U&&H?2:!U&&H?3:0:1};Object(z.a)(a,"RelativeAndAbsoluteReferencesManager",null,[637])},1144:function(z,F,b){function a(A){var t=this;this.$=A;(this.Ol=this.$.da.Aa(268))||e.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var E=r.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?
w.a.current.Bo(53):w.a.current.Bo(56);this.logger=new u.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Lca=new c(A,this.Ol);excelOnlineCalc.config.initCalc(this.logger,this.Ol?function(C){return t.Ol.isFeatureEnabled(C)}:function(){return!1},E);this.Kqg=excelOnlineCalc.config.calcConfig(this.Lca.localeInfo)}function c(A,t){A=b(1144).CalcHelper;t&&(t.He||e.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));
this.$vg=A.RHe(t,A.EHe(t.jka));this.awg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(F);z=b(0);var e=b(13),l=b(273),m;(function(A){A[A.paren=0]="paren";A[A.lead=1]="lead";A[A.intern=2]="intern";A[A.trail=3]="trail";A[A.undefined=4]="undefined"})(m||(m={}));Object(z.b)("CurrencyFormatOption",m);var n;(function(A){A[A.none=-1]="none";A[A.mdy=0]="mdy";A[A.dmy=1]="dmy";A[A.ymd=2]="ymd";A[A.myd=3]="myd";A[A.dym=4]="dym";A[A.ydm=5]="ydm"})(n||(n={}));Object(z.b)("DateOrderOption",n);var h=
b(9);c.prototype.formatNumber=function(A){return this.localeInfo.formatNumber(A)};uk.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.awg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.$vg}}});Object(z.a)(c,"LocaleHolder",null,[]);var u=b(1201),w=b(52),r=b(1),B=b(21),y=b(14),v=b(202);b.d(F,"CalcHelper",function(){return a});a.prototype.Weh=function(){if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return e.ULS.shipAssertTag(537170069,
0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var A=this.$.xa.oa;return A?A.index:(e.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.oa.index};a.prototype.createParser=function(){var A={};A.config=this.config;return excelOnlineCalc.parse.createParser(A)};a.prototype.createNumberFormatter=function(){var A=this,t=r.EwaSettings.isChangeGateEnabled("OfficeVSO:5935278_numberFormatterGetTime")?function(E,C){return excelOnlineCalc.calc.getTime(A.config,
E,C,"Estimation")}:function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))};t=excelOnlineCalc.numfmt.createFormatGlobals(this.config,t);return excelOnlineCalc.numfmt.createNumberFormatter(t)};a.prototype.gdh=function(A,t,E){t=excelOnlineCalc.location.gridCell(t,E);A=excelOnlineCalc.location.sheetIndex(this.documentLoc,A);return excelOnlineCalc.location.sheetGridCell(A,t)};a.prototype.Qqh=function(A,t){var E=excelOnlineCalc.calc.getEvalResultKind(A);switch(E){case 4:return{returnValue:A?
this.Lca.localeInfo.trueName:this.Lca.localeInfo.falseName,kind:E};case 1:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.OCc(this.Lca.formatNumber(A),t):this.Lca.formatNumber(A),kind:E};case 2:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.OCc(A.toString(),t):A.toString(),kind:E};case 128:return{returnValue:"",kind:E};case 8:switch(A.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Lca.localeInfo.errorNames[A.type],
kind:E};default:return{returnValue:a.unknownError,kind:E}}case 32:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.OCc(this.ydh(A,t),t):"##UNSUPPORTED: ARRAY",kind:E};default:return{returnValue:y.a.instance.fa(2154),kind:E}}};a.prototype.OCc=function(A,t){return A.length<=t?A:A.substring(0,t-3)+"..."};a.prototype.ydh=function(A,t){for(var E=this.Lca.localeInfo.leftBrace,C=0;C<A.rows;++C){for(var H=0;H<A.cols;++H)E+=A.opers[C][H],H<
A.cols-1&&(E+=this.Lca.localeInfo.columnSeparator);C<A.rows-1&&(E+=this.Lca.localeInfo.rowSeparator)}return this.OCc(E,t-1)+this.Lca.localeInfo.rightBrace};a.RHe=function(A,t){t=void 0===t?null:t;var E=a.k6b(),C=A.He.TrueValueString,H=A.He.FalseValueString,U=A.He.DecimalSeparator.toString(),Q=A.He.ListSeparator.toString(),O=A.He.ColumnSeparator.toString(),ea=A.He.RowSeparator.toString(),Z=A.He.ThousandsDataArray,S=A.He.ThousandSeparator.toString(),I=A.He.Lcid,P=A.He.Country,J=A.He.DigitsNumber,aa=
A.He.ExpSeparatedBySpace,ia=A.He.FractionSeparator.toString(),ba=A.He.PercentSeparatedBySpace,ra=B.a.nZg(Enum.toString(m,A.He.CurrencyFormat)),ka=A.He.CurrencySymbolLead,da=A.He.CurrencySeparatedBySpace,ha=A.He.CurrencySymbolString,qa=A.He.DigitsCurrency,Aa=-1===A.He.DateOrder?"MDY":v.c(Enum.toString(n,A.He.DateOrder)),Fa=A.He.DateSeparator.toString(),ab=A.He.DateAlternativeSeparator.toString(),Ua=A.He.Year4Digits,bb=A.He.Month2Digits,xa=A.He.Day2Digits,Gb=A.He.LongDateFormat,$b=A.He.TimeSeparator.toString(),
oa=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6195588_fixGetValueOrDefaultDullscriptBug")?A.He.TimeAltSeparator:null==A.He.TimeAltSeparator?null:A.He.TimeAltSeparator.toString(),Ma=A.He.Hour2Digits,Za=A.He.Use24HourClock,gb=A.He.AmPmSeparatedBySpace,zb=[A.He.AmString,A.He.PmString],nb=A.He.DayNameShortArray,pa=A.He.DayNameLongArray,Ja=A.He.MonthNameShortArray,Da=A.He.MonthNameLongArray,ib=A.He.PictureSpecialArray,Rb=l.a.map(("\x00"+A.He.PictureSingleString).split(""),function(jb){return"\x00"===
jb?null:jb}),wc=A.He.PictureColorArray,Cb=A.He.PictureDbnumArray,lb=A.He.RowLetter.toString(),yb=A.He.ColumnLetter.toString(),pc=A.He.LeftBrace.toString(),Ta=A.He.RightBrace.toString(),rb=A.He.LeftBracket.toString(),ic=A.He.RightBracket.toString(),Va=a.R2h(A.He);return excelOnlineCalc.calc.localeData(t,E,C,H,lb,yb,pc,Ta,rb,ic,U,Q,O,ea,Z,S,I,P,J,aa,ia,ba,ra,ka,da,ha,qa,Aa,Fa,ab,Ua,bb,xa,Gb,$b,oa,Ma,Za,gb,zb,nb,pa,Ja,Da,ib,Rb,wc,Cb,Va,A.He.SysDateFormatString,A.He.SysTimeFormatString)};a.EHe=function(A){var t=
[];if(!A)return t;A=Cl(A);for(var E=A.next();!E.done;E=A.next()){E=E.value;var C=null;E.IsDynamicUdf||(C=excelOnlineCalc.calc.worksheetFunctionName(E.FunctionIndexInServer,E.NameUI));C&&Array.add(t,C)}return t};a.k6b=function(){for(var A=[],t=Object.keys(h.a.errorNames),E=0;E<t.length;E++){var C=excelOnlineCalc.calc.errorTypeName(E+1,t[E]);C&&Array.add(A,C)}return A};a.R2h=function(A){var t=Array(6);t[1]="#"+A.AllStructRefString;t[3]="#"+A.HeadersStructRefString;t[2]="#"+A.DataStructRefString;t[4]=
"#"+A.TotalsStructRefString;t[5]="#"+A.ThisRowStructRefString;return t};uk.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.Kqg}}});a.unknownError="##ERR##";Object(z.a)(a,"CalcHelper",null,[])},1203:function(z,F,b){function a(){}b.d(F,"a",function(){return a});z=b(0);a.yxi="literal";a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.yof="letName";a.all="*";a.kXd="structRefRange";Object(z.a)(a,"TraverseFormulaInterestTypes",
null,[])},1204:function(z,F,b){function a(){}b.d(F,"a",function(){return a});z=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(z.a)(a,"TraverseFormulaRefTypes",null,[])},1459:function(z,F,b){function a(T){var ua=Wc.call(this)||this;ua.$=T;ua.Xb();return ua}function c(T){var ua=Eb.call(this)||this;ua.$=T;ua.Xb();return ua}function e(T,ua){var ma=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");
this.X6a=this.dbg=!1;this.gFb=function(){ma.X6a=!1};this.Qc=T;this.gridView=bb.g(T);this.calcManager=ua;this.Moi=Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.Hff=Aa.EwaSettings.ma(711);this.gridView.zc.Wo(this.gFb)}function l(T,ua,ma,wa){this.mOj=T;this.hcg=ua;this.Bjc=void 0===wa?!1:wa;ma?(this.k8a=ma.IsRangeRef,this.Gxa=ma.IsAbsoluteFirstRow,this.Fxa=ma.IsAbsoluteFirstColumn,this.XMa=ma.IsAbsoluteSecondRow,this.WMa=ma.IsAbsoluteSecondColumn):O.ULS.shipAssertTag(524039642,
0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function m(T){var ua=Nb.call(this)||this;ua.$=T;ua.Xb();return ua}function n(T){var ua=this;this.Hl=null;this.okg=!1;this.AOd=this.instantaneousSupportInformationManager=this.eHb=null;this.cxf={};this.exf={};this.Nfe=null;this.Kpc=function(ma){O.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");ma.DMd(ua.Kpc);ma.jka.length?ua.ppc(ma,Sys.EventArgs.Empty):(O.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),
ma.hre(ua.ppc))};this.ppc=function(ma){O.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ma.sMd(ua.ppc);ua.PSj(ma)};this.onContentReady=function(){ua.Hl&&(ua.instantaneousSupportInformationManager&&ua.instantaneousSupportInformationManager.Fpd||jb.Task.delay(0).CWCT(function(){ua.Hl.Dgb(1)},null,0,rc.a.current))};this.Lyf=function(ma,wa){ua.Hl&&(ua.instantaneousSupportInformationManager&&ua.instantaneousSupportInformationManager.Fpd||ua.Hl.$Ie(wa.gd.block))};O.ULS.sendTraceTag(537170067,
0,50,"Creating CalcManager");this.cgf=!1;this.wb=T;this.aw=bb.g(T);this.qIc=null;this.gridView.yr(this.onContentReady);this.gridView.Da.zXc(this.Lyf);this.$.da.Ya(268,function(ma){ma.He?(O.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),ua.Kpc(ma,Sys.EventArgs.Empty)):(O.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),ma.Cre(ua.Kpc))})}function h(){}function u(){}function w(){this.WMa=this.XMa=this.Fxa=this.Gxa=this.k8a=
!1}function r(T){var ua=this;this.mKd=null;this.Uwd=this.lKd=this.gGb=!1;this.kId=0;this.bId=this.dId=this.eId=this.cId=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Wm=this.errorTypeNames=null;this.rq=this.currentStateId=-1;this.Aua="";this.Haa=null;this.AEf=function(){ua.setNumberFormats()};this.vd=function(){O.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");ua.$e=new Gb.a;ua.rq=-1;ua.currentStateId=-1;ua.Aua="";ua.ptb=
null;ua.lKd=!1;ua.Wm&&ua.clearCache()};this.B9f=(this.Qc=T)?T.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.B9f;this.$e=new Gb.a;this.ptb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Qc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Epa()}function B(T){this.W6d=null;this.init(T)}function y(){}function v(T){this.Ooa=T;this.N6=new zb.a(nb.a.Uk());this.Pnc=!1}function A(){this.Bj=[];this.kgg=[];this.K0a={}}function t(T,ua,ma,wa,Ca){this.type=T;this.fullName=ua;this.range=
ma;this.sheetId=wa;this.attributes=Ca;this.gF=null}function E(T,ua){this.qze=T;this.sheetName=ua;this.Hxc=!1}function C(T){var ua=oa.call(this)||this;ua.$=T;ua.Xb();return ua}function H(T,ua){var ma=$b.call(this)||this;ma.AOa=P.a.Re;ma.e1c=null;ma.hlc=!1;ma.hhb=!1;ma.Pxf=function(){var wa=bb.g(ma.$);wa&&(wa=wa.rc(null))&&ma.pgb(wa.cell.Qm,!0)};ma.pQi=function(wa){ma.isActive()&&(qa.a.Ar(wa.Errors)||!wa.Result?O.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",
wa.Errors?wa.Errors.join(","):"None"):(wa=wa.Result,O.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",wa.Index,wa.Category),ma.Uwj(wa.Index,wa.Category),ma.raiseEvent(H.f2c,new aa.a(wa.Index,wa.Category),ma)))};ma.refresh=function(){O.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");ma.q3b();if(ma.isActive()&&ma.ea.pc.allowEdits){if(ma.hhb||ma.xn&&!(ma.ea.SCb>ma.AOa))ma.lFc();else{O.ULS.sendTraceTag(537155721,
0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var wa=ma.$.na.ta;var Ca=ma.xn?ma.xn.Digest:"",db=ma.YQi,Sa=ma.XQi,hb=wa.Ma(1,null);hb.previousResponseDigest=Ca;wa=ba.i(wa,"GetInstantaneousSupportInformation",hb,db,Sa,null,null,132);ma.pid=wa}O.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");ma.Q2e()}};ma.fCf=function(wa){O.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",
wa.data.status,wa.data.httpStatus);ma.qLa=null};ma.BO=function(){ma.hhb=!1;ma.ea.VD(ma.BO);ma.ySa(ma.hlc?H.GTd:H.kBd)};ma.fd=function(wa,Ca){O.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");ia.a(Ca)&&ma.ySa(H.GTd)};ma.Tf=function(){O.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==ma.$.workbookContext.CalcMode&&ma.wBd(0===ma.$.workbookContext.CalcMode)};ma.vd=function(){O.ULS.sendTraceTag(537155713,
0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");ma.ySa(H.GTd);Aa.EwaSettings.ma(305)&&3!==ma.$.workbookContext.CalcMode&&ma.wBd(0===ma.$.workbookContext.CalcMode)};ma.QQi=function(wa,Ca,db){O.ULS.sendTraceTag(537155712,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");ma.qLa=null;ma.isActive()?wa.StateId===P.a.Re?(O.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),
ma.lFc()):!wa.Result||ma.PY&&ma.PY.length?ma.ySa(H.kBd):ma.KFf(wa,Ca,db):O.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};ma.KFf=function(wa){ma.PY=wa.Result;O.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",ma.PY?ma.PY.length:-1);wa=!1;if(ma.PY){for(var Ca=Cl(ma.PY),db=Ca.next();!db.done;db=Ca.next())if(db=db.value)ma.DZe[db.NameUI.toLocaleUpperCase()]=
db.FunctionIndex.toString(),db.NameUI!==db.NameDataStrings&&(ma.DZe[db.NameDataStrings.toLocaleUpperCase()]=db.FunctionIndex.toString(),wa=!0),ma.SKh.ia(db.FunctionIndex,db.NameUI);ma.raiseEvent(H.rfd,Sys.EventArgs.Empty,ma)}wa&&O.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};ma.YQi=function(wa){if(ma.isActive())if(O.ULS.shipAssertTag(537155679,0,!!ma.$,"null ewaControl"),ma.hlc=!1,ma.AOa=wa.StateId,ma.AOa===
P.a.Re)ma.hlc=!0,ma.lFc();else{if(wa.Result){var Ca=ma.xn;ma.xn=wa.Result;O.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",ma.xn.Digest);wa=[];if(Ca)wa=H.pYh(Ca.NumberFormats,ma.xn.NumberFormats);else for(Ca=0;Ca<ma.xn.NumberFormats.length;Ca++)ma.poc.ia(Ca,ma.xn.NumberFormats[Ca].NumberFormatCategory);Ca=Cl(wa);for(var db=Ca.next();!db.done;db=Ca.next())db=db.value,ma.poc.ia(db,ma.xn.NumberFormats[db].NumberFormatCategory);ma.raiseEvent(H.SBd,new Q(wa),
ma);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&ma.raiseEvent(H.zpf)}ma.ySa(H.kBd)}};ma.XQi=function(wa){ma.isActive()&&(10===wa.data.status?O.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(O.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",wa.data.status,wa.data.httpStatus),ma.hlc=!0,ma.lFc()))};O.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");
ma.ea=T;ma.$=ua;ma.FIb=null;ma.pid=null;ma.qLa=null;ma.xn=null;ma.poc=new Gb.a;ma.Gwb=new Gb.a;ma.PY=[];ma.SKh=new Gb.a;ma.DZe={};ma.ea.ek(ma.fd);ma.$.fl(ma.vd);bb.g(ma.$).ga.Wsa(ma.Pxf);Aa.EwaSettings.ma(305)&&ma.ea.Yt(ma.Tf);ma.ySa(H.Zcf);O.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return ma}function U(T){this.data=T}function Q(T){var ua=ra.call(this)||this;ua.g5j=T;return ua}b.r(F);z=b(10);F=b(0);var O=b(13),ea=b(224),Z=b(89),S=b(4),I=b(199),P=b(9),J=b(36),
aa=b(1092),ia=b(227),ba=b(83),ra=Sys.EventArgs;Am(Q,ra);Object(F.a)(Q,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var ka=b(46),da=b(43),ha=b(34),qa=b(29),Aa=b(1),Fa=b(708),ab=b(21),Ua=b(288),bb=b(20),xa=b(203);Object(F.a)(U,"NumberFormatDataHolder",null,[]);var Gb=b(128),$b=J.a;Am(H,$b);H.prototype.Cre=function(T){this.addHandler(H.SBd,T)};H.prototype.DMd=function(T){this.removeHandler(H.SBd,T)};H.prototype.aIg=function(T){this.addHandler(H.f2c,T)};H.prototype.Sfj=function(T){this.removeHandler(H.f2c,
T)};H.prototype.hre=function(T){this.addHandler(H.rfd,T)};H.prototype.sMd=function(T){this.removeHandler(H.rfd,T)};H.prototype.GJg=function(T){this.addHandler(H.zpf,T)};H.prototype.pgb=function(T,ua){var ma=this.poc.Fc(T,0);var wa=ma.value;ma=ma.returnValue;!ma&&0<T&&this.$&&(O.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",T),this.hQh(T),ua&&(wa=this.gQh(T),ma=!0),Fa.a(T,this.$.sJ)&&
(wa=6));return{returnValue:ma,category:wa}};H.prototype.rni=function(T){var ua=this.pgb(T,!0);var ma=ua.category;if(ua.returnValue)return 6===ma;O.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",T);return!1};H.prototype.qJh=function(T){O.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.qLa=ba.x(this.$.na.ta,{FilterType:0},
Ua.b(this.KFf,T),this.fCf,null,null,null)};H.prototype.WYe=function(){this.ySa(H.Zcf)};H.prototype.wBd=function(T){this.e1c=T};H.prototype.hQh=function(T){if(this.Gwb&&this.$){var ua=this.Gwb.Fc(T);var ma=ua.value;if(!ua.returnValue||ma.isCompleted){O.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",T);ma=this.$.na.ta;ua=this.pQi;var wa=ma.Ma(1,null);wa.ifmt=T;(ma=ba.i(ma,"GetNumberFormatCategory",wa,ua,null,null,null,4))&&this.Gwb.ia(T,ma)}}else O.ULS.sendTraceTag(537155729,
0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};H.prototype.gQh=function(T){return 1<=T&&8>=T?1:9<=T&&12>=T?2:13===T||14===T?6:15===T?8:17===T|18===T?7:19===T?4:16===T||20<=T&&29>=T||31===T?11:30===T?9:32<=T&&35>=T?3:0};H.prototype.isActive=function(){var T=void 0===this.ea||null===this.ea,ua=!T&&this.ea.sc;O.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",
ua,T);return ua};H.prototype.Uwj=function(T,ua){this.poc.ia(T,ua)};H.prototype.dispose=function(){Z.a.Fa(this.FIb);this.FIb=null;this.q3b();for(var T=Cl(this.Gwb),ua=T.next();!ua.done;ua=T.next())(ua=ua.value.value)&&!ua.isCompleted&&S.AFrameworkApplication.Ld.Ku(ua.$t);this.Gwb=null;this.ea&&(this.ea.tk(this.fd),this.hhb&&this.ea.VD(this.BO),this.hhb=!1,this.ea.jx(this.Tf));this.ea=null;this.$&&bb.g(this.$)&&bb.g(this.$).ga&&(bb.g(this.$).ga.TAa(this.Pxf),this.$.Bl(this.vd));this.$=null;$b.prototype.dispose.call(this)};
H.prototype.isFeatureEnabled=function(T){try{switch(T){case "LocaleLongDateFormat":return Aa.EwaSettings.ma(197);case "GetLocaleDayNames":return Aa.EwaSettings.ma(198);case "CalculateTextWidthIgnoreLetterSpacing":return Aa.EwaSettings.ma(286);case "OfficeVSO:3657744_CalcFixForDateFormat":return Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return Aa.EwaSettings.ma(247);case "CalcContractChecks":return Aa.EwaSettings.ma(248);case "CalcSupportDynamicArrays":return Aa.EwaSettings.ma(249);case "CalcFormatCalculations":return Aa.EwaSettings.ma(250);case "CalcFormulaCacheAPIChanges":return Aa.EwaSettings.ma(251);case "CalcStrictFormulaChecking":return Aa.EwaSettings.ma(252);
case "CalcSupportRowReference":return Aa.EwaSettings.ma(263);case "CalcParserUsesPledges":return Aa.EwaSettings.ma(310);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return Aa.EwaSettings.ma(309);case "CalcLookupFunctions":return Aa.EwaSettings.ma(311);case "CalcLogStopWatch":return Aa.EwaSettings.ma(374);case "CalcPreventSpillingHack":return Aa.EwaSettings.ma(253);case "CalcDynamicArrayOperators":return Aa.EwaSettings.ma(103);case "CalcDotOperator":return Aa.EwaSettings.ma(601);case "CalcLetFunction":return Aa.EwaSettings.ma(722);
default:return T.startsWith("OfficeVSO:")?Aa.EwaSettings.isChangeGateEnabled(T):!1}}catch(ua){return O.ULS.sendTraceTag(537155724,0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",T,ua.toString()),!1}};H.prototype.ySa=function(T){this.isActive()&&this.ea.pc.allowEdits?(Z.a.Fa(this.FIb),this.FIb=null,this.FIb=ka.a.instance.create(this.refresh,T,da.a.Whi)):O.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",
void 0!==this.ea&&null!==this.ea&&void 0!==this.ea.pc&&null!==this.ea.pc?this.ea.pc.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};H.prototype.Q2e=function(){O.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.qLa?O.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.PY&&this.PY.length||(this.qLa=ba.x(this.$.na.ta,{FilterType:0},
this.QQi,this.fCf,null,null,null)):O.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};H.prototype.lFc=function(){this.hhb||(this.hhb=!0,this.ea.UE(this.BO))};H.prototype.q3b=function(){this.Ku(this.pid);this.Ku(this.qLa);this.qLa=this.pid=null};H.prototype.Ku=function(T){T&&!T.isCompleted&&this.$.na.ta.ogb(T.$t)};H.pYh=function(T,ua){if(!T||!T.length)return[];if(!ua||!ua.length){ua=Array(T.length);for(var ma=0;ma<
T.length;++ma)ua[ma]=T[ma].IfmtIndex;return ua}var wa=new Gb.a;T=Cl(T);for(ma=T.next();!ma.done;ma=T.next())ma=ma.value,wa.ia(ma.IfmtIndex,new U(ma));T=new I.a;ma={};ua=Cl(ua);for(var Ca=ua.next();!Ca.done;ma={Ghb:ma.Ghb,jRb:ma.jRb},Ca=ua.next())ma.Ghb=Ca.value,ma.jRb=void 0,function(db){return function(){var Sa=wa.Fc(db.Ghb.IfmtIndex);db.jRb=Sa.value;return Sa}}(ma)().returnValue&&ma.jRb.data.FormatString===ma.Ghb.FormatString||T.add(ma.Ghb.IfmtIndex);return T.toArray()};uk.Object.defineProperties(H.prototype,
{He:{configurable:!0,enumerable:!0,get:function(){return this.xn?this.xn.LocaleInformation:null}},cda:{configurable:!0,enumerable:!0,get:function(){return this.xn?this.xn.NumberFormats:[]}},jka:{configurable:!0,enumerable:!0,get:function(){this.PY&&this.PY.length||this.Q2e();return this.PY}},Shi:{configurable:!0,enumerable:!0,get:function(){return this.xn&&void 0!==this.xn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.xn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.xn.InstantaneousCalcWebWorkerPrecisionSamplingRate:
H.Cgh}},Vhi:{configurable:!0,enumerable:!0,get:function(){return this.xn&&void 0!==this.xn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.xn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.xn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:H.Ggh}},Uhi:{configurable:!0,enumerable:!0,get:function(){return this.xn&&void 0!==this.xn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.xn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.xn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
H.Fgh}},Thi:{configurable:!0,enumerable:!0,get:function(){return this.xn&&void 0!==this.xn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.xn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.xn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:H.Egh}},Nef:{configurable:!0,enumerable:!0,get:function(){return this.xn?this.xn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:H.Dgh}},Fpd:{configurable:!0,enumerable:!0,get:function(){return null!==this.e1c?this.e1c:
this.xn?this.xn.InstantaneousCalcManualMode:!1}}});H.SBd="isim0";H.f2c="isim1";H.rfd="isim2";H.zpf="isim3";H.Zcf=100;H.GTd=1E3;H.kBd=3E5;H.Cgh=.001;H.Ggh=.1;H.Fgh=.2;H.Egh=.001;H.Dgh=50;Object(F.a)(H,"InstantaneousSupportInformationManager",J.a,[520,3]);var oa=ea.a;Am(C,oa);C.prototype.create=function(){this.$&&(O.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Eb(this.$.da.Aa(268)||new H(this.$.ea,this.$)))};C.ka=function(T){if(!T)throw Error.argumentNull("ewaControl");
T.da.Ha(246,new C(T))};Object(F.a)(C,"InstantaneousSupportInformationManagerFactory",ea.a,[]);var Ma=b(82),Za=b(111),gb=b(81);Object(F.a)(E,"CalcBlockInformation",null,[]);Object(F.a)(t,"CalcNamedObject",null,[]);Object(F.a)(A,"GridCache",null,[]);var zb=b(893),nb=b(614);Object(F.a)(v,"SheetInformation",null,[]);var pa=b(1144),Ja;(function(T){T[T.initialization=0]="initialization";T[T.contentReady=1]="contentReady";T[T.cellEdit=2]="cellEdit"})(Ja||(Ja={}));Object(F.b)("UpdateDataTrigger",Ja);var Da=
b(62);y.local="Local";y.COj="Thread";Object(F.a)(y,"RecalcServiceCreateMode",null,[]);var ib=b(45),Rb=b(39),wc=b(165);B.prototype.init=function(T){this.W6d=new Gb.a;if(void 0!==T&&null!==T&&void 0!==T.HeadersList&&null!==T.HeadersList&&0<T.HeadersList.length){T=Cl(T.HeadersList);for(var ua=T.next();!ua.done;ua=T.next())ua=ua.value,this.naa.ia(ua.Index,ua.Name)}};uk.Object.defineProperties(B.prototype,{naa:{configurable:!0,enumerable:!0,get:function(){return this.W6d}}});Object(F.a)(B,"ColHeadersListData",
null,[]);var Cb=b(98);b(202);var lb=b(290);r.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.DMd(this.AEf);this.Qc&&this.Qc.Bl(this.vd);this.close()};r.prototype.Dgb=function(T){if(!this.Wm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Qc.da.Aa(268),!this.instantaneousSupportInformationManager))return O.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),
!1;2!==T&&(this.currentStateId=this.Qc.ea.SCb,this.currentStateId===P.a.Re&&(this.currentStateId=this.Qc.ea.af));if(1===T&&this.currentStateId<this.rq)return O.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.rq),!1;this.Uuj();0!==T&&this.lKd||(this.jzj(),this.pwj(),this.$wj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Cre(this.AEf),this.Qc.fl(this.vd),this.lKd=!0);this.Maj();
var ua=!1;0===T&&(ua=this.Ffi());if(0!==T||ua)this.vyj()?(this.Zyj(T),this.Yyj(),this.rq=this.currentStateId,this.V0g()):O.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==T&&this.resumeRecalc();return!0};r.prototype.evalFormula=function(T){if(!this.Wm)return O.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});T=this.Wm.evalFormula(this.Qc.ea.af,T,Da.d(this.Qc.xa.oa));
this.resumeRecalc();return T};r.prototype.evalFormulaRange=function(T,ua,ma){if(!this.Wm)return O.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);O.ULS.shipAssertTag(537170193,0,ua.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");ma=ib.j(ma);ua=ib.o(ua,this.Qc);ua=excelOnlineCalc.calc.cellLocation(ua.FirstRow,ua.FirstColumn);ma=r.oV("EvalFormulaRange",Da.d(this.Qc.xa.oa),ma.FirstRow,ma.FirstColumn,
ma.LastRow,ma.LastColumn);O.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.rq);T=this.Wm.evalFormulaRange(this.rq,T,ua,ma,null);T.then(function(wa){if(excelOnlineCalc.util.isSuccess(wa)){var Ca=[];wa=Cl(wa.value);for(var db=wa.next();!db.done;db=wa.next())db=db.value,excelOnlineCalc.util.isSuccess(db.value)||(db=db.value.reason.kind.toString(),Array.contains(Ca,db)||Ca.push(db));O.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",
Ca.length?Sys.Serialization.JavaScriptSerializer.serialize(Ca):"None")}else O.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",wa.reason.kind)}).catch(function(wa){O.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(wa));return Promise.reject(wa)});this.resumeRecalc();return T};r.prototype.JXg=function(T,ua,ma,wa){wa=void 0===
wa?null:wa;if(this.Wm&&T){var Ca=Da.d(this.Qc.xa.oa),db=T.cell.XK-1,Sa=T.cell.WK-1,hb=db,Xb=Sa,xb=null;wa&&(xb=excelOnlineCalc.calc.cellLocation(db,Sa),db=wa.top-1,Sa=wa.left-1,hb=wa.bottom-1,Xb=wa.right-1);if(T.cell.nu)if(wa=T.cell.nu.Z_c,wa===P.a.Re)O.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",T.cell.nu.Zd);else if(wa<this.rq)O.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",
db,Sa,wa,this.rq);else if(wa<this.currentStateId)O.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",db,Sa,wa,this.currentStateId);else if(this.gGb||(this.Wm.setOnRecalcResults(ma),this.gGb=!0),this.Yfg()&&!this.Dgb(2))O.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{Xb=r.oV("CalculateFormula.cell",Ca,db,Sa,hb,Xb);ma=[];var Sb=bb.g(this.Qc);hb=Sb.nh;bb.g(this.Qc).rb.jj&&
(hb=Sb.Kf(1).nh,hb.Coa(1,1),hb.Coa(3,1));Sb=null;hb?Sb=r.oV("CalculateFormula.viewport",Ca,hb.top-1,hb.left-1,hb.bottom-1,hb.right-1):O.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");ua=excelOnlineCalc.calc.inferredRangeFormulaEdit(Xb,ua,xb,Sb);Array.add(ma,ua);T=hb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ca,db,Sa,ab.a.a1b(T.cell.text),
wa,hb.top-1,hb.left-1,hb.bottom-1,hb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ca,db,Sa,ab.a.a1b(T.cell.text),wa,"","","","");O.ULS.sendTraceTag(537170181,0,50,T);this.Wm.editRangeFormulas(wa,ma);this.resumeRecalc()}else O.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",T.cell.XK,T.cell.WK)}else O.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",
!this.Wm,!T)};r.prototype.HXg=function(T,ua,ma,wa){wa=void 0===wa?null:wa;var Ca=Da.d(this.Qc.xa.oa),db=T.cell.XK-1,Sa=T.cell.WK-1,hb=db,Xb=Sa,xb=null;wa&&(xb=excelOnlineCalc.calc.cellLocation(db,Sa),db=wa.top-1,Sa=wa.left-1,hb=wa.bottom-1,Xb=wa.right-1);ma=this.N1d(T,ma,"SetCell");0>ma||(Xb=r.oV("CalculateFormula.cell",Ca,db,Sa,hb,Xb),hb=[],wa=this.Rkd(Ca),ua=excelOnlineCalc.calc.inferredRangeFormulaEdit(Xb,ua,xb,wa),Array.add(hb,ua),T=(ua=this.j8e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Ca,db,Sa,ab.a.a1b(T.cell.text),ma,ua.top-1,ua.left-1,ua.bottom-1,ua.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Ca,db,Sa,ab.a.a1b(T.cell.text),ma,"","","",""),O.ULS.sendTraceTag(537170180,0,50,T),this.Wm.editRangeFormulas(ma,hb),this.resumeRecalc())};r.prototype.Yub=function(T,ua,ma,wa){if(!this.Wm)return O.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),
Promise.reject("RecalcService is null");if(!ma||!ua)return O.ULS.sendTraceTag(524120779,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: "+!ma+", outputColumnRange null: "+!ua),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");O.ULS.shipAssertTag(537170178,0,ma.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Ca=Da.d(this.Qc.xa.oa),db=this.Rkd(Ca),Sa=null;if(T){Sa=[];T=Cl(T);for(var hb=T.next();!hb.done;hb=
T.next())if(hb=hb.value,hb.column!==ma.left){var Xb=hb.row-1;var xb=hb.column-1;Xb=r.oV("EvalFormulaRangeOnClone.cell",Ca,Xb,xb,Xb,xb);xb=hb.text;Array.add(Sa,excelOnlineCalc.calc.rangeWrite(Xb,excelOnlineCalc.calc.valueCellData(xb,xb,hb.Qm,null)))}}ma=excelOnlineCalc.calc.cellLocation(ma.top-1,ma.left-1);ua=r.oV("EvalFormulaRangeOnClone.outputColumnRange",Ca,ua.top-1,ua.left-1,ua.bottom-1,ua.right-1);wa=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(ua,wa,ma,db)];Sa=this.Wm.evalOnClonedModel(Sa,
wa);this.resumeRecalc();return Sa};r.prototype.$Ie=function(T){var ua=null;try{if(T)if(this.Aua=bb.g(this.Qc).Da.kwa(T),this.currentStateId=T.jUa,this.currentStateId<this.rq||this.currentStateId===P.a.Re)O.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.Aua,this.currentStateId,this.rq);else{if(this.Kfi(),!this.ISg()){var ma=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",
this.Aua,this.currentStateId);ua=this.Qc.Sb.Hc("ModelUpdate",ma);this.ptb=this.Sxb(T.oa.sheetName);if(!this.ptb){var wa=!!(this.Qc.Dd&32);O.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.$e.xb(this.currentStateId)&&this.$e.pa(this.currentStateId).Bj?this.$e.pa(this.currentStateId).Bj.length:0,wa,T.oa.sheetName?T.oa.sheetName.length:-1,T.oa.hash)}else if(bb.g(this.Qc).Da.Wl.W2a(T.Zd)){var Ca=
T.Gf;if(Ca){var db=Ca.getCalcBlockModel();if(!db)O.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.ASg(db)){this.$e.pa(this.currentStateId).K0a[this.Aua]=new E(db,T.oa.sheetName);var Sa=T.ye;Sa?this.NFg(Sa.NamedObjects):O.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else O.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.Aua)}}}else O.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{ua&&ua.stop()}};r.prototype.M5a=function(T){if(!this.$e.pa(this.currentStateId).Bj||!this.$e.pa(this.currentStateId).Bj[0])return null;var ua=this.$e.pa(this.currentStateId).Bj[0].N6;if(!ua||!ua.xb(T.name))return null;ua=ua.pa(T.name);if(!ua||!ua.gF)return null;T=new I.a;ua=Cl(ua.gF.naa);for(var ma=ua.next();!ma.done;ma=ua.next())T.add(ma.value.value);return T};
r.prototype.getNameLoc=function(T,ua){return this.ejc()?this.$e.pa(this.currentStateId).Bj[0].N6.xb(ua)?(T=excelOnlineCalc.location.nameLoc(T,ua),excelOnlineCalc.util.success(T)):excelOnlineCalc.util.success(null):(T=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(T))};r.prototype.getContainingTable=function(T){if(!this.ejc())return T=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(T);var ua=T.range.col,ma=T.range.row,wa=this.$e.pa(this.currentStateId).Bj[0].N6,
Ca=null;wa=Cl(wa);for(var db=wa.next();!db.done;db=wa.next())if(db=db.value.value,2===db.type&&ab.a.equals(T.sheet.index.toString(),db.sheetId,!0)){var Sa=db.range;ua>=Sa.left-1&&ua<=Sa.right-1&&ma<=Sa.bottom-1&&ma>=Sa.top-1&&(Ca=excelOnlineCalc.location.nameScope(this.documentLoc,db.sheetId),Ca=excelOnlineCalc.location.nameLoc(Ca,db.fullName))}return Ca?excelOnlineCalc.util.success(Ca):excelOnlineCalc.util.success(null)};r.prototype.getStructRefColumn=function(T,ua){if(!this.ejc()){var ma=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(ma)}ma=T.name;var wa=this.$e.pa(this.currentStateId).Bj[0].N6;if(wa.xb(ma)){wa=wa.pa(ma);var Ca=wa.range;if(2!==wa.type)return excelOnlineCalc.util.failure(this.E6c(5));var db=wa.gF?wa.gF.naa:null;if(!db)return excelOnlineCalc.util.success(null);for(var Sa=Cl(db),hb=Sa.next();!hb.done;hb=Sa.next())if(hb=hb.value,ab.a.equals(hb.value,ua,!0))return T=excelOnlineCalc.location.documentLoc(T.scope.document.path,T.scope.document.name),T=excelOnlineCalc.location.sheetIndex(T,
wa.sheetId),Ca=excelOnlineCalc.location.gridRange(Ca.top-1,hb.key,Ca.bottom-Ca.top+1,1),Ca=excelOnlineCalc.location.sheetGridRange(T,Ca),ma=excelOnlineCalc.location.structRefColumnLoc(ma,Ca,!!(wa.attributes&16),!!(wa.attributes&8)),excelOnlineCalc.util.success(ma);return Ca.right-Ca.left+1!==db.count?(ma=excelOnlineCalc.util.unavailable([17,T,ua]),excelOnlineCalc.util.failure(ma)):excelOnlineCalc.util.failure(this.E6c(0))}return excelOnlineCalc.util.success(null)};r.prototype.getStructRefSpecialRef=
function(T,ua){if(!this.ejc())return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);var ma=this.$e.pa(this.currentStateId).Bj[0].N6;if(ma.xb(T.name)){var wa=ma.pa(T.name);if(2!==wa.type)return excelOnlineCalc.util.failure(this.E6c(5));ma=!!(wa.attributes&16);var Ca=!!(wa.attributes&8),db=ma?1:0,Sa=Ca?1:0;T=excelOnlineCalc.location.documentLoc(T.scope.document.path,T.scope.document.name);T=excelOnlineCalc.location.sheetIndex(T,wa.sheetId);wa=wa.range;var hb={};if(1===ua)hb=
excelOnlineCalc.location.gridRange(wa.top-db-1,wa.left-1,wa.bottom+Sa-wa.top+db+1,wa.right-wa.left+1);else if(2===ua)hb=excelOnlineCalc.location.gridRange(wa.top-1,wa.left-1,wa.bottom-wa.top+1,wa.right-wa.left+1);else if(3===ua)if(ma)hb=excelOnlineCalc.location.gridRange(wa.top-2,wa.left-1,1,wa.right-wa.left+1);else return excelOnlineCalc.util.success(null);else if(4===ua)if(Ca)hb=excelOnlineCalc.location.gridRange(wa.bottom,wa.left-1,1,wa.right-wa.left+1);else return excelOnlineCalc.util.success(null);
ua=excelOnlineCalc.location.sheetGridRange(T,hb);return excelOnlineCalc.util.success(ua)}return excelOnlineCalc.util.success(null)};r.prototype.getDocumentLoc=function(T,ua){if((ab.a.equals(T,this.documentLoc.path,!0)||!T)&&ab.a.equals(ua,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);T=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(T,ua)]);return excelOnlineCalc.util.failure(T)};r.prototype.getSheetIndex=function(T,ua){if(!this.$e.xb(this.currentStateId)||
!this.$e.pa(this.currentStateId).Bj)return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);T=this.$e.pa(this.currentStateId).Bj;for(var ma=1;ma<T.length;ma++)if(ab.a.equals(T[ma].Ooa.sheetName,ua,!0))return excelOnlineCalc.util.success(T[ma].Ooa.sheetId);return excelOnlineCalc.util.success(null)};r.prototype.getSheetName=function(T,ua){if(!this.$e.xb(this.currentStateId)||!this.$e.pa(this.currentStateId).Bj)return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);
T=this.$e.pa(this.currentStateId).Bj;for(var ma=1;ma<T.length;ma++)if(ab.a.equals(T[ma].Ooa.sheetId,ua,!0))return excelOnlineCalc.util.success(T[ma].Ooa.sheetName);return excelOnlineCalc.util.success(null)};r.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};r.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
r.prototype.IXg=function(T,ua,ma){var wa=bb.g(this.Qc),Ca=wa.rc(ua);Ca=this.N1d(Ca,null,"CopyPaste");ma=this.N1d(wa.rc(T),ma,"CopyPaste");if(0>Ca||0>ma||Ca!==ma)O.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",ma,Ca);else{ma=[];wa=Da.d(this.Qc.xa.oa);var db=this.Rkd(wa);T=r.oV("CalculateFormulaForCopyPaste.srcRange",wa,T.top-1,T.left-1,T.bottom-1,T.right-1);ua=r.oV("CalculateFormulaForCopyPaste.targetRange",
wa,ua.top-1,ua.left-1,ua.bottom-1,ua.right-1);ua=excelOnlineCalc.calc.copyPasteRangePasteEdit(ua,T,db);Array.add(ma,ua);ua=db?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",wa,Ca,db.row,db.column,db.lastRow,db.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",wa,Ca,"","","","");O.ULS.sendTraceTag(537170142,0,50,ua);this.Wm.editRangePaste(Ca,
ma);this.resumeRecalc()}};r.prototype.Rkd=function(T){var ua=this.j8e(),ma=null;ua?ma=r.oV("GetViewport.viewport",T,ua.top-1,ua.left-1,ua.bottom-1,ua.right-1):O.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return ma};r.prototype.j8e=function(){var T=bb.g(this.Qc),ua=T.nh;if(bb.g(this.Qc).rb.jj){ua=T.Kf(1).nh;if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!ua)return O.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;ua.Coa(1,1);ua.Coa(3,1)}return ua};r.prototype.N1d=function(T,ua,ma){if(!this.Wm||!T)return O.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Wm,!T,ma),-1;var wa=T.cell.XK-1,Ca=T.cell.WK-1;if(T.cell.nu){var db=T.cell.nu.Z_c;if(db===P.a.Re)return O.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
T.cell.nu.Zd,ma),-1}else return O.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",T.cell.XK,T.cell.WK,ma),-1;if(db<this.rq)return O.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",wa,Ca,db,this.rq,ma),-1;if(db<this.currentStateId)return O.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
wa,Ca,db,this.currentStateId,ma),-1;ua&&!this.gGb&&(this.Wm.setOnRecalcResults(ua),this.gGb=!0);return this.Yfg()&&!this.Dgb(2)?(O.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",ma),-1):db};r.prototype.getFormulaBarText=function(T,ua,ma){return ua&&ua.startsWith("'")?ua:T.cell.formulaBarText||ma.toString()};r.prototype.och=function(T,ua,ma){var wa=null;if(this.Xze()&&this.$e.pa(this.rq).K0a){var Ca=this.$e.pa(this.rq).K0a[T];if(null===
Ca||void 0===Ca?0:Ca.Hxc)wa=Ca.qze}ma=this.wki(wa,ua,ma);ua=this.y4g(wa,ua,ma);O.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",T,this.currentStateId,ua)};r.prototype.wki=function(T,ua,ma){var wa=!1,Ca=r.v0e(ua);if(T){var db=r.v0e(T);ab.a.equals(db,Ca,!1)&&(wa=!0)}wa?this.pGg(T,this.rq,ma):this.rGg(ua,ma);return wa};r.prototype.Xze=function(){var T=!1;this.Wm&&-1!==this.rq&&(T=this.Wm.stateIdAvailable(this.rq));
return T&&this.$e.xb(this.rq)&&this.rq<this.currentStateId};r.prototype.y4g=function(T,ua,ma){var wa=0;var Ca,db;for(ua.reset();Ca=ua.getNextCell();)xa.e(Ca.formula)&&wa++,(db=ma?T.getCell(Ca.row,Ca.col):null)?this.u4g(ua,Ca,db):this.qGg(ua,Ca);if(ma)for(T.reset();db=T.getNextCell();)(Ca=ua.getCell(db.row,db.col))||this.Zpe(T,db);return wa};r.prototype.$wj=function(){this.Wm.setOnUpdateRequest(function(){})};r.prototype.Zwj=function(){var T=this;this.Wm.setOnUnresponsive(function(ua,ma,wa,Ca){T.cZi(ua,
ma,wa,Ca)})};r.prototype.cZi=function(T,ua,ma,wa){O.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",T,ua,ma,wa);wa&&(this.amj(),this.Epa())};r.prototype.amj=function(){this.vd(null,null);this.Uwd=this.gGb=!1;this.kId=0;this.bId=this.dId=this.eId=this.cId=-1};r.prototype.close=function(){this.Wm.close()};r.prototype.clearCache=function(){this.Wm.clearCache()};r.prototype.resumeRecalc=function(){this.Wm.resumeRecalc()};
r.prototype.pwj=function(){this.Wm.setA1ReferenceStyle(!0)};r.prototype.Maj=function(){if(this.instantaneousSupportInformationManager){var T=this.instantaneousSupportInformationManager.Shi,ua=this.instantaneousSupportInformationManager.Vhi,ma=this.instantaneousSupportInformationManager.Uhi,wa=this.instantaneousSupportInformationManager.Thi,Ca=!1;T!==this.cId&&(Ca=!0,this.cId=T);ua!==this.eId&&(Ca=!0,this.eId=ua);ma!==this.dId&&(Ca=!0,this.dId=ma);wa!==this.bId&&(Ca=!0,this.bId=wa);var db=[];Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",
!1)&&(Ca=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),db.push(Ca),Ca=!0);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Ca=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),db.push(Ca),Ca=!0);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Ca=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),db.push(Ca),Ca=!0);Ca&&(T=excelOnlineCalc.calc.recalcServiceConfig(null,T,
null,ua,null,null,null,ma,db,wa),this.Wm.reconfigure(T))}};r.prototype.Zyj=function(T){var ua=this,ma=null;if(this.$e.xb(this.currentStateId))try{this.Haa=[];var wa=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,Ja[T]);ma=this.Qc.Sb.Hc("ModelUpdate",wa);Za.a.forEach(this.$e.pa(this.currentStateId).K0a,function(Ca,db){db.Hxc||(ua.och(Ca,db.qze,db.sheetName),db.Hxc=!0)},null);this.Wm.updateRanges(this.currentStateId,this.Haa)}finally{ma&&ma.stop()}else O.ULS.sendTraceTag(537170122,
0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};r.prototype.Yyj=function(){var T=[],ua=this.Xze(),ma=ua&&this.$e.pa(this.rq).Bj&&this.$e.pa(this.rq).Bj[0]&&this.$e.pa(this.rq).Bj[0].Pnc?this.$e.pa(this.rq).Bj[0].N6:null;this.NEe(ma,this.$e.pa(this.currentStateId).Bj[0].N6,null,this.rq,T);this.$e.pa(this.currentStateId).Bj[0].Pnc=!0;for(var wa=1;wa<this.$e.pa(this.currentStateId).Bj.length;wa++)ma=-1,ua&&this.$e.pa(this.rq).Bj&&(ma=this.$jd(this.$e.pa(this.currentStateId).Bj[wa].Ooa.sheetName,
this.rq)),ma=-1!==ma&&this.$e.pa(this.rq).Bj[ma].Pnc?this.$e.pa(this.rq).Bj[ma].N6:null,this.NEe(ma,this.$e.pa(this.currentStateId).Bj[wa].N6,this.$e.pa(this.currentStateId).Bj[wa].Ooa.sheetId,this.rq,T),this.$e.pa(this.currentStateId).Bj[wa].Pnc=!0;this.Wm.updateNamedObjects(this.currentStateId,T)};r.prototype.NEe=function(T,ua,ma,wa,Ca){if(void 0!==ma&&null!==ma){var db=excelOnlineCalc.calc.undefinedNamesWrite(ma);Array.add(Ca,db)}if(T){var Sa=!1,hb=[];db=[];if(ua)for(var Xb=Cl(ua),xb=Xb.next();!xb.done;xb=
Xb.next()){xb=xb.value;var Sb=xb.value;if(T.xb(xb.key)){var qb=T.pa(xb.key);r.xIi(qb,Sb)?Sa=!0:(qb=excelOnlineCalc.calc.namedObject(xb.key,null),Array.add(hb,qb),r.bXc(xb.key,Sb,db))}else r.bXc(xb.key,Sb,db)}T=Cl(T);for(xb=T.next();!xb.done;xb=T.next())Xb=xb.value,ua&&ua.xb(Xb.key)||(Xb=excelOnlineCalc.calc.namedObject(Xb.key,null),Array.add(hb,Xb));Sa&&(ua=excelOnlineCalc.calc.namedObjectsPromote(ma,wa),Array.add(Ca,ua));0<hb.length&&(ua=excelOnlineCalc.calc.namedObjectsWrite(ma,hb),Array.add(Ca,
ua));0<db.length&&(ma=excelOnlineCalc.calc.namedObjectsWrite(ma,db),Array.add(Ca,ma))}else if(ua){db=[];ua=Cl(ua);for(wa=ua.next();!wa.done;wa=ua.next())wa=wa.value,r.bXc(wa.key,wa.value,db);0<db.length&&(ma=excelOnlineCalc.calc.namedObjectsWrite(ma,db),Array.add(Ca,ma))}};r.prototype.ISg=function(){return this.$e.pa(this.currentStateId).K0a[this.Aua]?(O.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.Aua,this.currentStateId),
!0):!1};r.prototype.ASg=function(T){return 1===T.getColumnNumbers().length&&T.getColumnNumbers()[0]===r.izd+1?!1:!0};r.prototype.Ffi=function(){var T=this,ua=!1;bb.g(this.Qc).Da.Jed(function(ma){ma.state&1&&T.Qc.ea.af===ma.me.Revision&&(T.$Ie(ma),ua=!0)});return ua};r.prototype.$Ge=function(T,ua){var ma=T.getRowNumbers(),wa=T.getColumnNumbers();T=ma[0]-1;ma=ma[ma.length-1]-1;var Ca=wa[0]-1;wa=wa[wa.length-1]-1;(ua=this.Sxb(ua))||O.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",
this.$e.xb(this.currentStateId)&&this.$e.pa(this.currentStateId).Bj?this.$e.pa(this.currentStateId).Bj.length:0);return r.oV("CreateBlockRangeLocation",ua,T,Ca,ma,wa)};r.prototype.pGg=function(T,ua,ma){if(ma=this.$Ge(T,ma)){var wa=r.l6b(T.getRowNumbers());T=r.l6b(T.getColumnNumbers());ua=excelOnlineCalc.calc.rangePromote(ma,ua,wa,T);this.Haa[this.Haa.length]=ua}};r.prototype.rGg=function(T,ua){if(ua=this.$Ge(T,ua)){var ma=r.l6b(T.getRowNumbers());T=r.l6b(T.getColumnNumbers());T=excelOnlineCalc.calc.rangeWrite(ua,
null,ma,T);this.Haa[this.Haa.length]=T}};r.prototype.u4g=function(T,ua,ma){var wa=null,Ca=0,db=0;switch(ua.valueType){case 2:wa=this.Pkd(ua);var Sa=this.Pkd(ma);Sa=ab.a.equals(Sa,wa,!1);break;case 1:null===ua.value&&null===ma.value?Sa=!0:(Ca=parseFloat(ua.value),Sa=parseFloat(ma.value)===Ca);break;default:null===ua.value&&null===ma.value?Sa=!0:(db=parseFloat(ua.value),Sa=db===parseFloat(ma.value))}Sa&&ua.valueType===ma.valueType&&ua.ifmt===ma.ifmt&&ua.formulaType===ma.formulaType&&ab.a.equals(ma.formula,
ua.formula,!1)||(void 0!==ua.formula&&null!==ua.formula||void 0!==ua.value&&null!==ua.value||void 0!==ua.text&&null!==ua.text?this.B_b(T,ua,wa,Ca,db):this.Zpe(T,ua))};r.prototype.NFg=function(T){if(this.Qc.Ab&&this.Qc.Ab.items)for(var ua=0;ua<this.Qc.Ab.count;ua++){var ma=this.Qc.Ab.items[ua];if(2===ma.type||3===ma.type){var wa=0,Ca=ma.name,db=Ca.lastIndexOf("!");if(0<db){wa=Ca.substr(0,db);"'"===wa.charAt(0)&&(wa=wa.substr(1,wa.length-2));wa=this.$jd(wa,this.currentStateId);if(-1===wa){O.ULS.sendTraceTag(595096334,
0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.pa(this.currentStateId).Bj?this.$e.pa(this.currentStateId).Bj.length:0);continue}Ca=Ca.substr(db+1)}wa=this.$e.pa(this.currentStateId).Bj[wa].N6;var Sa=ma.usedRange;2===ma.type&&(Sa=wc.a(ma));if(wa.xb(Ca)){if(db=wa.pa(Ca),Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(db.range=Sa,db.attributes=ma.attributes),2===db.type&&
(Ca=r.yXe(ma.name,T),ma=(wa=Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?ma.wP:null===Ca||void 0===Ca?void 0:Ca.ColHeadersList,Ca||wa))if(!db.gF)db.gF=new B(ma);else if(ma)for(ma=Cl(ma.HeadersList),Ca=ma.next();!Ca.done;Ca=ma.next())Ca=Ca.value,db.gF.naa.ia(Ca.Index,Ca.Name)}else if(db=this.Sxb(ma.sheetName)){db=new t(ma.type,ma.name,Sa,db,ma.attributes);if(2===db.type)if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&ma.wP)db.gF=
new B(ma.wP);else if(ma=r.yXe(ma.name,T))db.gF=new B(ma.ColHeadersList);wa.ia(Ca,db)}else O.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.pa(this.currentStateId).Bj?this.$e.pa(this.currentStateId).Bj.length:0)}}};r.prototype.B_b=function(T,ua,ma,wa,Ca){var db=T.getRowNumbers()[ua.row]-1;T=T.getColumnNumbers()[ua.col]-1;db=r.oV("AddRangeUpdateCommand",this.ptb,db,T,db,T);T=null;var Sa=
ua.formula||ua.text,hb=excelOnlineCalc.calc.blankValue,Xb=null;void 0!==ua.text&&null!==ua.text||void 0!==ua.value&&null!==ua.value||(ma="",Xb="This cell contains blanks only",0===ua.formulaType&&(Sa=""));switch(ua.valueType){case 2:null!==ma&&(0===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData(Sa,ma,ua.ifmt,Xb)),1===ua.formulaType&&(T=excelOnlineCalc.calc.cellFormulaCellData(Sa,ma,ua.ifmt,Xb)),2===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData("",hb,0,"This cell is a part of an array")));
break;case 1:isNaN(wa)?O.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",ua.row,ua.col):(0===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData(Sa,wa,ua.ifmt,null)),1===ua.formulaType&&(T=excelOnlineCalc.calc.cellFormulaCellData(Sa,wa,ua.ifmt,null)),2===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData("",hb,0,"This cell is a part of an array")));break;case 3:isNaN(Ca)?O.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
ua.row,ua.col):(ma=1===Ca?!0:!1,0===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData(Sa,ma,ua.ifmt,null)),1===ua.formulaType&&(T=excelOnlineCalc.calc.cellFormulaCellData(Sa,ma,ua.ifmt,null)),2===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData("",hb,0,"This cell is a part of an array")));break;case 4:isNaN(Ca)?O.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",ua.row,ua.col):(ma=excelOnlineCalc.calc.errorValue(Ca),0===ua.formulaType&&
(T=excelOnlineCalc.calc.valueCellData(Sa,ma,ua.ifmt,null)),1===ua.formulaType&&(T=excelOnlineCalc.calc.cellFormulaCellData(Sa,ma,ua.ifmt,null)),2===ua.formulaType&&(T=excelOnlineCalc.calc.valueCellData("",hb,0,"This cell is a part of an array")));break;default:T=excelOnlineCalc.calc.valueCellData("",hb,ua.ifmt,null)}T&&(ua=excelOnlineCalc.calc.rangeWrite(db,T,null,null),this.Haa[this.Haa.length]=ua)};r.prototype.qGg=function(T,ua){switch(ua.valueType){case 2:this.B_b(T,ua,this.Pkd(ua),null,0);break;
case 1:this.B_b(T,ua,null,parseFloat(ua.value),0);break;default:this.B_b(T,ua,null,null,parseFloat(ua.value))}};r.prototype.Zpe=function(T,ua){var ma=T.getRowNumbers()[ua.row]-1;T=T.getColumnNumbers()[ua.col]-1;ma=r.oV("AddRangeUpdateCommandEmptyCell",this.ptb,ma,T,ma,T);ua=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,ua.ifmt,null);ua=excelOnlineCalc.calc.rangeWrite(ma,ua,null,null);this.Haa[this.Haa.length]=ua};r.prototype.Sxb=function(T){T=this.$jd(T,this.currentStateId);
return 0<T?this.$e.pa(this.currentStateId).Bj[T].Ooa.sheetId:null};r.prototype.$jd=function(T,ua){if(!this.$e.xb(ua))return O.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",ua),-1;if(!this.$e.pa(ua).Bj)return O.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",ua),-1;ua=this.$e.pa(ua).Bj;for(var ma=1;ma<ua.length;ma++)if(ab.a.equals(ua[ma].Ooa.sheetName,T,!1))return ma;
return-1};r.prototype.vyj=function(){if(!this.$e.xb(this.currentStateId)||!this.$e.pa(this.currentStateId).Bj.length)return O.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var T=[],ua=1;ua<this.$e.pa(this.currentStateId).Bj.length;ua++){var ma=this.$e.pa(this.currentStateId).Bj[ua];ma&&Array.add(T,ma.Ooa)}this.Wm.updateSheetNames(this.currentStateId,T);this.Wm.updateUnusedCells(this.currentStateId,
this.$e.pa(this.currentStateId).kgg);return!0};r.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var T=[],ua=Cl(this.instantaneousSupportInformationManager.cda),ma=ua.next();!ma.done;ma=ua.next())ma=ma.value,ma=excelOnlineCalc.calc.numberFormat(ma.IfmtIndex,ma.FormatString,ma.Builtin),Array.add(T,ma);this.Wm.setNumberFormats(T,!0)}};r.prototype.Uuj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.He){var T=
this.Ifi();if(!this.Uwd||T)this.k6b(),this.instantaneousSupportInformationManager.He.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.He.TrueValueString),this.instantaneousSupportInformationManager.He.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.He.FalseValueString),T=pa.CalcHelper.RHe(this.instantaneousSupportInformationManager,T),this.Wm.setLocale(T),this.Uwd=!0}};r.prototype.jzj=function(){var T=null;if(void 0!==this.Qc.workbookContext.TimeZoneInformation&&
null!==this.Qc.workbookContext.TimeZoneInformation){T=null;this.Qc.workbookContext.TimeZoneInformation.StandardDate.Month&&(T=excelOnlineCalc.date.dateTime(this.Qc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Qc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var ua=null;this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(ua=excelOnlineCalc.date.dateTime(this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));T=excelOnlineCalc.date.tzData(this.Qc.workbookContext.TimeZoneInformation.Bias,T,this.Qc.workbookContext.TimeZoneInformation.StandardBias,ua,this.Qc.workbookContext.TimeZoneInformation.DaylightBias)}else O.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");T=excelOnlineCalc.calc.workbookProps(this.Qc.workbookContext.F1904,this.Qc.workbookContext.FDateCompatibility,T);this.Wm.setWorkbookProps(T)};r.prototype.Epa=function(){var T=this;Aa.EwaSettings.ma(309)&&lb.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.B9f,!0)).continueWith(function(ma){ma.exception?O.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",ma.exception.toString()):O.ULS.sendTraceTag(537170080,
0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var ua=Aa.EwaSettings.ma(674)?y.local:y.COj;this.mKd=lb.c(excelOnlineCalc.calc.createRecalcService(ua,Rb.a.xW()));this.mKd.continueWith(function(ma){ma.exception?O.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",ma.exception.toString()):(O.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),T.Wm=T.mKd.result,T.Wm?
T.Dgb(0)?T.Zwj():O.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):O.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};r.prototype.Ifi=function(){var T=this.instantaneousSupportInformationManager.jka;if(!T||this.kId===T.length)return null;this.kId=T.length;return pa.CalcHelper.EHe(T)};r.prototype.k6b=function(){this.errorTypeNames=pa.CalcHelper.k6b()};r.prototype.Kfi=function(){if(!(this.$e.xb(this.currentStateId)&&
0<this.$e.pa(this.currentStateId).Bj.length)){this.$e.ia(this.currentStateId,new A);this.$e.pa(this.currentStateId).Bj[0]=new v(null);for(var T=this.Qc.xa,ua=0;ua<T.count;ua++){var ma=Object(gb.a)(Cb.a,T.getItem(ua));if(ma){void 0!==ma.sheetId&&null!==ma.sheetId&&void 0!==ma.name&&null!==ma.name&&ma.sheetId.length&&ma.sheetName.length||O.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",ua,ma.sheetId,ma.hash,ma.name?
ma.name.length:-1);var wa=excelOnlineCalc.calc.sheetName(ma.sheetId,ma.name);this.$e.pa(this.currentStateId).Bj[ua+1]=new v(wa);wa=ma.usedRange.rM();wa=excelOnlineCalc.calc.rangeLocation(0,0,wa.LastRow,wa.LastColumn);ma=excelOnlineCalc.calc.unusedCellsUpdate(ma.sheetId,wa);Array.add(this.$e.pa(this.currentStateId).kgg,ma)}else O.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,ua)}}};r.prototype.V0g=function(){for(var T=
Cl(this.$e),ua=T.next();!ua.done;ua=T.next())ua=ua.value,ua.key<this.rq&&this.$e.remove(ua.key)};r.prototype.Pkd=function(T){T=T.value||T.text;if(void 0===T||null===T)T="";return T};r.prototype.Yfg=function(){if(!this.$e.xb(this.currentStateId))return!1;var T=!1;Za.a.forEach(this.$e.pa(this.currentStateId).K0a,function(ua,ma){ma.Hxc||(T=!0)},null);return T};r.prototype.E6c=function(T){var ua={};ua.reason=T;ua.kind=1;return ua};r.prototype.ejc=function(){return this.$e.xb(this.currentStateId)&&this.$e.pa(this.currentStateId).Bj&&
this.$e.pa(this.currentStateId).Bj[0]&&this.$e.pa(this.currentStateId).Bj[0].N6?!0:!1};r.s9g=function(T){var ua=[];if(null===T||void 0===T?0:T.naa){T=Cl(T.naa);for(var ma=T.next();!ma.done;ma=T.next())ma=ma.value,ma=excelOnlineCalc.calc.columnData(ma.key,ma.value),Array.add(ua,ma)}return ua};r.xIi=function(T,ua){if(T.type!==ua.type||T.attributes!==ua.attributes||!ab.a.equals(T.fullName,ua.fullName,!1)||!T.range.equals(ua.range))return!1;if(!T.gF&&!ua.gF)return!0;if(!T.gF||!ua.gF||T.gF.naa.count!==
ua.gF.naa.count)return!1;var ma={};T=Cl(T.gF.naa);for(var wa=T.next();!wa.done;ma={Ihb:ma.Ihb,Phb:ma.Phb},wa=T.next())if(ma.Ihb=wa.value,ma.Phb=void 0,!(ma.Ihb.value&&function(Ca){return function(){var db=ua.gF.naa.Fc(Ca.Ihb.key);Ca.Phb=db.value;return db}}(ma)().returnValue&&ma.Phb&&ab.a.equals(ma.Ihb.value,ma.Phb,!1)))return!1;return!0};r.bXc=function(T,ua,ma){var wa=r.oV("NamedObject",ua.sheetId,ua.range.top-1,ua.range.left-1,ua.range.bottom-1,ua.range.right-1);if(2===ua.type){var Ca=!!(ua.attributes&
16),db=!!(ua.attributes&8);ua=r.s9g(ua.gF);wa=excelOnlineCalc.calc.namedTableData(wa,Ca,db,ua);T=excelOnlineCalc.calc.namedObject(T,wa)}else wa=excelOnlineCalc.calc.namedRangeData(wa),T=excelOnlineCalc.calc.namedObject(T,wa);Array.add(ma,T)};r.v0e=function(T){var ua=Sys.Serialization.JavaScriptSerializer.serialize(T.getRowNumbers());T=Sys.Serialization.JavaScriptSerializer.serialize(T.getColumnNumbers());return ua+T};r.l6b=function(T){var ua=null;if(1<T.length)for(var ma=1;ma<T.length;ma++)for(var wa=
0;T[ma-1]+1+wa<T[ma];)ua=ua||[],Array.add(ua,T[ma-1]+wa),wa++;return ua};r.yXe=function(T,ua){if(!ua)return null;for(var ma=0,wa=ua.length;ma<wa;++ma)if(ab.a.equals(T,ua[ma].Name,!1))return ua[ma];return null};r.oV=function(T,ua,ma,wa,Ca,db){function Sa(hb,Xb,xb,Sb){(0>xb||xb>=Sb)&&O.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",hb,Xb,xb)}void 0!==ua&&null!==ua||O.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",
T);Sa(T,"top",ma,r.Ftf);Sa(T,"left",wa,r.izd);Sa(T,"bottom",Ca,r.Ftf);Sa(T,"right",db,r.izd);return excelOnlineCalc.calc.sheetRangeLocation(ua,ma,wa,Ca,db)};r.Ftf=1048576;r.izd=16384;Object(F.a)(r,"CalcAsyncEngine",null,[3]);Object(F.a)(w,"AbsoluteRelativeReferenceInfo",null,[]);var yb=b(1202),pc=b(24);u.XLf="#";Object(F.a)(u,"Operators",null,[]);var Ta=b(1203);h.sheet="Sheet";h.sheetRange="SheetRange";h.document="Document";h.uci="Ident";Object(F.a)(h,"TraverseFormulaQualifierTypes",null,[]);var rb=
b(1204),ic=b(1093),Va=b(1003),jb=b(53),rc=b(60);n.prototype.dispose=function(){var T=this;O.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.Ya(268,function(ua){ua.DMd(T.Kpc);ua.sMd(T.ppc)});this.gridView&&(this.gridView.Nt(this.onContentReady),this.gridView.Da&&this.gridView.Da.WTf(this.Lyf),this.aw=null);this.exf=this.cxf=this.qIc=null};n.prototype.KXg=function(T,ua,ma,wa){wa=void 0===wa?null:wa;this.Hl&&(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?
this.Hl.HXg(T,ua,ma,wa):this.Hl.JXg(T,ua,ma,wa))};n.prototype.evalFormula=function(T){return this.Hl?this.Hl.evalFormula(T):Promise.reject("calc engine not initialized")};n.prototype.evalFormulaRange=function(T,ua,ma){return this.Hl?this.Hl.evalFormulaRange(T,ua,ma):Promise.reject("calc engine not initialized")};n.prototype.Yub=function(T,ua,ma,wa){return this.Hl?this.Hl.Yub(T,ua,ma,wa):Promise.reject("CalcEngine is null")};n.prototype.M5a=function(T){return this.Hl?(O.ULS.shipAssertTag(537170059,
0,2===T.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.Hl.M5a(T)):null};n.prototype.VMg=function(T,ua){if(!ua||2!==T.type)return!1;T=wc.a(T);return T.right-T.left+1===ua.count};n.prototype.YVe=function(T){if(!this.eHb)return this.okg||O.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var ua=this.lua(pc.Range.kd(1,1));ua=this.eHb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ua.range),T);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ua))return O.ULS.sendTraceTag(537170056,
0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var ma=this.gridView.ga.va.activeCell,wa=excelOnlineCalc.location.gridCell(ma.top-1,ma.left-1),Ca=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),db=excelOnlineCalc.location.sheetIndex(Ca,this.$.xa.oa.sheetId),Sa=this.Jch(wa,db);this.AOd||(this.AOd=excelOnlineCalc.util.createResolver(this.Ich()));
var hb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ua,this.ns.config.localeInfo,Aa.EwaSettings.ma(612),Sa,this.AOd)}else hb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ua,this.ns.config.localeInfo,Aa.EwaSettings.ma(612));Aa.EwaSettings.ma(103)&&this.kYj(hb,T);return hb}catch(Xb){return O.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",Xb.message),null}};n.prototype.extractLetVariables=function(T,ua){if(!this.eHb)return this.okg||
O.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var ma=this.lua(pc.Range.kd(1,1));T=this.eHb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ma.range),T);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(T))return O.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(T,ua,this.ns.config.localeInfo)}catch(wa){return O.ULS.sendTraceTag(537170052,
0,10,"CalcManager.ExtractLetVariables - exception: {0}",wa.message),null}};n.prototype.extractReferences=function(T,ua,ma,wa){if(!ua)return O.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ma)return O.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Ca=this.YVe(T);if(!Ca)return O.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.Jbh(Ca,
ua,ma,T,wa)}catch(db){return O.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",db.message),null}};n.prototype.l3h=function(T,ua,ma,wa){if(!T)return O.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!ua||0>=ua.length)return O.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;T=this.lua(T);if(!this.ns||!T)return null;var Ca=
this.Hwb(T).returnValue;if(!Ca||Ca.C7a)return null;ma=excelOnline.utils.getCharIndexInTextFromPoint(ma,wa,Aa.EwaSettings.ma(612));return 0>ma?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.ns.config,ma,ua,T)};n.prototype.yXg=function(T,ua,ma,wa){var Ca=this;if(!T)return O.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var db=null;return this.evalFormula(ua).then(function(Sa){var hb=Ca.ns.Qqh(Sa,ma),Xb=hb.returnValue;8!==
hb.kind||Xb.length&&Xb!==pa.CalcHelper.unknownError?Sa=0:(O.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),Sa=excelOnlineCalc.calc.getEvalFailureReason(Sa),void 0!==Sa&&null!==Sa||O.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),Sa=1);return db=wa?new yb.a(Xb,wa.start,wa.end,Sa):new yb.a(Xb,-1,-1,Sa)},function(Sa){O.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",
Sa);return Promise.resolve(db)})};n.prototype.getSubExpressionSpan=function(T){return this.ns&&T?excelOnlineCalc.runtime.getSubExpressionSpan(T):null};n.prototype.getFormulaSubExpressionObject=function(T,ua,ma){return this.ns&&T&&ua&&ma?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.ns.config,ua,ma,this.lua(T)):null};n.prototype.o3h=function(T,ua,ma){return this.ns&&T&&ua?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.ns.config,ua,ma,this.lua(T)):null};n.prototype.m3h=
function(T,ua,ma){return this.ns&&T&&ua?excelOnlineCalc.runtime.getSubExpressionSubspans(this.ns.config.localeInfo,ua,ma):null};n.prototype.IXh=function(){return this.ns?this.ns.config.localeInfo.listSeparator:null};n.prototype.isFormulaSubExpressionVolatile=function(T){return this.ns?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.ns.config.localeInfo,T):!1};n.prototype.lua=function(T){return T&&this.ns?this.ns.gdh(this.ns.Weh(),T.top-1,T.left-1):null};n.prototype.vni=function(T,ua){T=
this.Tid(T);if(void 0===T||null===T)return null;T=this.uq.createFormat(T.FormatString,T.Builtin);if(!excelOnlineCalc.util.isSuccess(T))return null;ua=this.uq.parseEdit(ua,T.value);return excelOnlineCalc.util.isSuccess(ua)?ua.value.kind===ic.a.formula:null};n.prototype.Sid=function(T){if(!T.isValid())return O.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",null!=T.HF?T.HF.toString():"null",T.formatString?ab.a.ZJ(T.formatString):
"null",T.numberFormat?"!null":"null"),null;var ua=T.tWh();if("String"===Object.getType(ua).getName())var ma=this.exf;else if("Number"===Object.getType(ua).getName())ma=this.cxf;else return O.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;ua=ua.toString();if(ua in ma)return ma[ua].numberFormat;ma[ua]=T;return T.numberFormat};n.prototype.getWorksheetFuncId=function(T){return this.localeInfo.getWorksheetFuncId(T)};n.prototype.Jbh=function(T,ua,ma,wa,Ca){for(var db=
{Items:[]},Sa=0;Sa<T.length;Sa++){var hb=T[Sa],Xb={};Xb.Start=hb.span.start;Xb.End=hb.span.end;if(Ca||hb.kind!==Ta.a.func)if(Ca||hb.kind!==Ta.a.yxi){if(this.Olh(hb,ua,ma)){var xb=new w,Sb=this.p0h(hb,ua,xb,wa);if(Aa.EwaSettings.ma(612)){var qb=this.yXh(hb),mb=this.xXh(hb);if(Sb||mb&&0<=qb)Xb={Span:Xb,LetNumber:qb,LetName:mb,Range:Sb},Xb.IsRangeRef=xb.k8a,Xb.IsAbsoluteFirstRow=xb.Gxa,Xb.IsAbsoluteFirstColumn=xb.Fxa,Xb.IsAbsoluteSecondRow=xb.XMa,Xb.IsAbsoluteSecondColumn=xb.WMa,Xb.IsStructRef=hb.kind===
Ta.a.kXd,Array.add(db.Items,Xb)}else Sb&&(Xb={Span:Xb,Range:Sb},Xb.IsRangeRef=xb.k8a,Xb.IsAbsoluteFirstRow=xb.Gxa,Xb.IsAbsoluteFirstColumn=xb.Fxa,Xb.IsAbsoluteSecondRow=xb.XMa,Xb.IsAbsoluteSecondColumn=xb.WMa,Xb.IsStructRef=hb.kind===Ta.a.kXd,Array.add(db.Items,Xb))}}else hb=hb.ref.value.oper.kind,Array.add(db.Items,{Span:Xb,IsString:2===hb,IsBoolean:4===hb,IsNumber:1===hb});else Xb.End=hb.span.start+hb.ref.name.length,hb={Span:Xb,IsFunction:!0},hb.FunctionId=this.getWorksheetFuncId(wa.substring(Xb.Start,
Xb.End)),Array.add(db.Items,hb)}db.Items.sort(function(ac,Uc){return ac.Span.Start-Uc.Span.Start});return db};n.prototype.yXh=function(T){return T.kind===Ta.a.yof?T.ref.number:-1};n.prototype.xXh=function(T){return T.kind===Ta.a.yof?T.ref.name:null};n.prototype.p0h=function(T,ua,ma,wa){if(T.kind===Ta.a.range)return ma.k8a=!0,this.ZFe(T,ua,ma,wa);if(T.kind===Ta.a.namedRange){ma=T.ref;(T=this.$.Ab.getItemByName(ma.name))||(T=this.$.Ab.getItemByName(ua+"!"+ma.name));if(!(T&&T.sheetName&&T.usedRange&&
ab.a.equals(T.sheetName,ua,!0)))return null;ua=2===T.type?wc.a(T):T.usedRange;return ib.m(ua,T)}if(T.kind===Ta.a.kXd){var Ca=T.ref,db;Ca.name?(db=this.$.Ab.getItemByName(Ca.name))||(db=this.$.Ab.getItemByName(ua+"!"+Ca.name)):db=this.gridView.Tb.Wj(this.gridView.ga.va.activeCell);if(!(db&&db.sheetName&&db.usedRange&&ab.a.equals(db.sheetName,ua,!0)))return null;ma.k8a=!1;return this.ZFe(T,ua,ma,wa)}return null};n.prototype.ZFe=function(T,ua,ma,wa){T=T.ref;if(T.type){if(T.type===rb.a.column){var Ca=
T.startIndex;T=T.endIndex;ma.Fxa=Ca.kind===Va.a.abs;ma.WMa=T.kind===Va.a.abs;return this.createRange(0,Ca.index,P.a.Sh,T.index,ua)}if(T.type===rb.a.row)return Ca=T.endIndex,ma.Gxa=T.startIndex.kind===Va.a.abs,ma.XMa=Ca.kind===Va.a.abs,this.createRange(T.startIndex.index,0,T.endIndex.index,P.a.di,ua);if(T.type===rb.a.cell){Ca=T.row;var db=T.col;ma.Gxa=ma.XMa=Ca.kind===Va.a.abs;ma.Fxa=ma.WMa=db.kind===Va.a.abs;return this.D3b(T.span.end,wa)&&(ma=pc.Range.kd(Ca.index+1,db.index+1),ma=this.gridView.Tb.a7e(ma))?
ib.n(ma,ua):this.createRange(Ca.index,db.index,Ca.index,db.index,ua)}if(T.type===rb.a.range){Ca=T.top;db=T.left;wa=T.bottom;T=T.right;var Sa=Math.min(Ca.index,wa.index),hb=Math.min(db.index,T.index),Xb=Math.max(Ca.index,wa.index),xb=Math.max(db.index,T.index);ma.Gxa=Ca.kind===Va.a.abs;ma.XMa=wa.kind===Va.a.abs;ma.Fxa=db.kind===Va.a.abs;ma.WMa=T.kind===Va.a.abs;return this.createRange(Sa,hb,Xb,xb,ua)}O.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
T.type);return null}O.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};n.prototype.D3b=function(T,ua){return ua.length>=T&&0<T&&ua.charAt(T-1)===u.XLf};n.prototype.EXg=function(T,ua,ma){this.Hl&&this.Hl.IXg(T,ua,ma)};n.prototype.Tid=function(T){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.cda&&this.instantaneousSupportInformationManager.cda[T]&&this.uq?this.instantaneousSupportInformationManager.cda[T]:
null};n.prototype.toXLNumber=function(T){if(!this.uq)return null;T=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.uq,T);return excelOnlineCalc.util.isSuccess(T)?T.value:null};n.prototype.kYj=function(T,ua){if(T){T=Cl(T);for(var ma=T.next();!ma.done;ma=T.next())if(ma=ma.value,ma.ref.type&&ma.ref.type===rb.a.cell){var wa=ma.ref;n.F4i(wa,ua)&&(wa.span.end+=1,ma.span.end+=1)}}};n.prototype.createRange=function(T,ua,ma,wa,Ca){var db={};db.FirstRow=T;db.FirstColumn=ua;db.LastRow=ma;db.LastColumn=
wa;db.SheetName=Ca;return db};n.prototype.Olh=function(T,ua,ma){var wa=T.ref.qualifier;if(!wa)return!0;switch(T.ref.qualifier.type){case h.sheet:return T=wa.document,ab.a.equals(wa.sheet,ua,!0)&&(!T||ab.a.equals(T.document,ma,!0));case h.sheetRange:return ua=this.$.xa.getItemByName(ua),ma=this.$.xa.getItemByName(wa.sheet1),wa=this.$.xa.getItemByName(wa.sheet2),!!ua&&!!ma&&!!wa&&(ma.index<=ua.index&&ua.index<=wa.index||wa.index<=ua.index&&ua.index<=ma.index);case h.document:return ab.a.equals(wa.document,
ma,!0);case h.uci:return wa=wa.name,ab.a.equals(wa,ua,!0)||ab.a.equals(wa,ma,!0);default:return O.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",wa.type),!1}};n.prototype.PSj=function(T){this.instantaneousSupportInformationManager=T;T.cda.length&&T.jka.length?(this.qIc=new pa.CalcHelper(this.gridView.$),this.eHb=this.ns.createParser(),this.Nfe=this.ns.createNumberFormatter(),this.cgf=!0,O.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.Hl||(O.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.Hl=new r(this.$))):O.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",T.cda.length,T.jka.length.toString())};n.prototype.Hwb=function(T){if(!T)return{returnValue:null,emptyCell:!1};var ua=this.getSheetName(T.sheet.index);if(!ua)return O.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",T.sheet.index),{returnValue:null,emptyCell:!1};var ma=n.convertToRange(T);ua=this.gridView.Hwb(ua,ma.top,ma.left);return ua?ua.Jlh?{returnValue:ua,emptyCell:!1}:(O.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",T.range.row,T.range.col),{returnValue:null,emptyCell:!0}):(O.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",T.range.row,T.range.col),
{returnValue:null,emptyCell:!1})};n.prototype.getSheetName=function(T){var ua=this.gridView.$.xa.getItem(T);return ua?ua.sheetName:(O.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",T),null)};n.prototype.Jch=function(T,ua){var ma={allowUnqualifiedCell:!0,wrapCellReferences:!0};ma.config=this.ns.config;ma.originGridCell=excelOnlineCalc.util.success(T);ma.originSheet=excelOnlineCalc.util.success(ua);return ma};n.prototype.Ich=function(){var T={};T.config=this.ns.config;
T.getNameLoc=Object(Ma.a)(this.Hl,this.Hl.getNameLoc,"getNameLoc");T.getContainingTable=Object(Ma.a)(this.Hl,this.Hl.getContainingTable,"getContainingTable");T.getStructRefColumn=Object(Ma.a)(this.Hl,this.Hl.getStructRefColumn,"getStructRefColumn");T.getStructRefSpecialRef=Object(Ma.a)(this.Hl,this.Hl.getStructRefSpecialRef,"getStructRefSpecialRef");T.getDocumentLoc=Object(Ma.a)(this.Hl,this.Hl.getDocumentLoc,"getDocumentLoc");T.getSheetIndex=Object(Ma.a)(this.Hl,this.Hl.getSheetIndex,"getSheetIndex");
T.getSheetName=Object(Ma.a)(this.Hl,this.Hl.getSheetName,"getSheetName");T.getUserDefinedFuncLoc=Object(Ma.a)(this.Hl,this.Hl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");T.getSheetRangeIndexes=Object(Ma.a)(this.Hl,this.Hl.getSheetRangeIndexes,"getSheetRangeIndexes");return T};n.F4i=function(T,ua){return ua.length>T.span.end&&ua.charAt(T.span.end)===u.XLf};n.convertToRange=function(T){return pc.Range.kd(T.range.row+1,T.range.col+1)};uk.Object.defineProperties(n.prototype,{ns:{configurable:!0,enumerable:!0,
get:function(){return this.qIc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.aw}},$:{configurable:!0,enumerable:!0,get:function(){return this.wb}},uq:{configurable:!0,enumerable:!0,get:function(){return this.Nfe}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.ns?this.ns.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.ns.config}}});Object(F.a)(n,"CalcManager",null,[635,3]);var Cc=b(35),Hc=b(52),Nb=ea.a;Am(m,Nb);
m.prototype.create=function(){var T=this;if(this.$){O.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var ua=53;var ma="Current"}else ua=56,ma="Stable";O.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",ma);Cc.TaskExtensions.Ba(Hc.a.loadScript(ua,4,this.ub,void 0,void 0,265),function(){O.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var wa=T.$.da.Aa(266,!1);wa||(O.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),wa=new n(T.$));T.Eb(wa)},this.la,3)}else O.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};m.ka=function(T){T&&T.da&&T.da.Ha(265,new m(T))};Object(F.a)(m,"CalcManagerFactory",ea.a,[]);var nc=b(5),Ha=b(337);Object(F.a)(l,"MarqueeMetadata",null,[]);var tb=b(141),Ub=b(696),gc=b(353);e.prototype.mY=
function(T,ua){this.Moi&&T.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.dbg||T.cL)return!1;var ma=void 0===ua||null===ua?T.text:ua;if(this.calcManager&&1<ma.length&&xa.e(ma)){var wa=this.gjd(),Ca=this.c5e(),db=this.Qc.workbookContext.WorkbookFileName,Sa=!1,hb=.01>Math.random()?Object(gb.a)(tb.a,this.Qc.Sb.Hc("LoadingUIShown","ColoredReferencesManager")):null;try{var Xb=this.calcManager.extractReferences(ma,Ca,db,!this.Hff);if(!Xb)return O.ULS.sendTraceTag(524039689,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;Ca=[];db=[];for(var xb=[],Sb=[],qb=0,mb=0,ac=new ha.a(!1),Uc="",Zc=Cl(Xb.Items),Kc=Zc.next();!Kc.done;Kc=Zc.next()){var va=Kc.value;Sa=va.IsStructRef||Sa;if(va.IsBoolean||va.IsNumber||va.IsString){var fb=va.IsBoolean?e.USg:va.IsNumber?e.gKi:e.HLj;this.FGa(db,ma,qb,va.Span.Start,null);this.FGa(db,ma,va.Span.Start,va.Span.End,fb);qb=va.Span.End}else if(Aa.EwaSettings.ma(612)){if(va.Range||
va.LetName&&0<=va.LetNumber){Xb=null;if(va.Range){var Pb=ib.D(va.Range);Xb=this.Nwb(Pb,ac,1);Array.add(Ca,new gc.a(Pb,wa))}else va.LetName&&0<=va.LetNumber&&(Xb=Uc=this.UQh(va.LetName,va.LetNumber,ac,Uc),mb!==ac.count&&T.colors.add(va.Span.Start+"-"+va.Span.End,this.colors[(ac.count-1)%this.colors.length]));this.FGa(db,ma,qb,va.Span.Start,null);this.FGa(db,ma,va.Span.Start,va.Span.End,Xb);qb=va.Span.End;Array.add(xb,va.Span);var sc=db.length-1;Array.add(Sb,new l(sc,db[sc].text,va));mb=ac.count}}else if(va.Range){var hd=
ib.D(va.Range),Ob=this.Nwb(hd,ac,1);this.FGa(db,ma,qb,va.Span.Start,null);this.FGa(db,ma,va.Span.Start,va.Span.End,Ob);Array.add(Ca,new gc.a(hd,wa));qb=va.Span.End;Array.add(xb,va.Span);var Ac=db.length-1;Array.add(Sb,new l(Ac,db[Ac].text,va))}}this.FGa(db,ma,qb,ma.length,null);this.Ryj(T,db,!!ua);var sb=T.textBox.text;if(!ab.a.equals(sb,ma,!1)){O.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
sb.length,ma.length);var ad=T.textBox.caretPosition;T.textBox.text=ma;T.textBox.caretPosition=ad;return!0}this.cgc(Ca,ac,Sb);Aa.EwaSettings.ma(612)&&0<Ca.length&&O.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");Aa.EwaSettings.ma(612)&&0<T.colors.count&&O.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.X6a=!0}finally{hb&&hb.aCa(function(){Sa&&O.ULS.sendTraceTag(524039686,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",hb.Gc)})}}else return this.cgc(null,null),this.X6a&&(this.X6a=!1,wa=T.textBox.caretPosition,T.textBox.setPlainText(ma),T.textBox.caretPosition=Math.min(wa,ma.length),ua)?!0:!1};e.prototype.Ruf=function(T,ua,ma){if(!T||!ua||!ma)return O.ULS.shipAssertTag(524039685,0,!!T,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),O.ULS.shipAssertTag(524039684,0,!!ua,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
O.ULS.shipAssertTag(524039683,0,!!ma,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var wa=Object(gb.a)(l,ua.metadata);if(!wa)return O.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Ca=wa.mOj,db=wa.hcg,Sa=this.gridView.Tb.ahf(ma)?ma.Pcc(wa.Fxa,wa.Gxa):ma.F5a(wa.Fxa,wa.Gxa,wa.WMa,wa.XMa);if(!Sa)return O.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var hb=db.indexOf("!");
-1!==hb&&(Sa=db.substring(0,hb+1)+Sa);if(!T.textBox.changeTextInExistingTextPart(Ca,db,Sa))return O.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;wa.hcg=Sa;Ca=!0;for(db=1;4>=db;db++)(Sa=bb.g(this.Qc).Fb.Iw(3,db,ua.oaa))?(Sa.range=ma,Sa.metadata=wa):(O.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Ca=!1);this.gridView.Fb.update(!1,!1);this.gridView.yj&&(this.gridView.Ac.textBox.text=
T.text);this.gridView.Ac.fIb(new Ha.a({yAb:!0}));return Ca};e.prototype.Qoi=function(T){if(3!==T.Jr)return O.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;T=Object(gb.a)(l,T.metadata);return T?T.k8a&&!T.Bjc:(O.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};e.prototype.xfb=function(T,ua){O.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+
(ua?"suspending":"resuming")+" colored references");ua&&this.X6a&&(this.X6a=!1,this.cgc(null,null),T.textBox.s1g());this.dbg=ua};e.prototype.dispose=function(){this.gridView&&this.gridView.zc&&this.gridView.zc.Zn(this.gFb)};e.prototype.rbi=function(T){var ua=this.gjd(),ma=this.c5e(),wa=this.Qc.workbookContext.WorkbookFileName,Ca=[],db=new ha.a(!1),Sa=[];if(ma=this.calcManager.extractReferences(T,ma,wa,!this.Hff)){ma=Cl(ma.Items);for(wa=ma.next();!wa.done;wa=ma.next())if(wa=wa.value,wa.Range){var hb=
ib.D(wa.Range);Array.add(Ca,new gc.a(hb,ua));this.Nwb(hb,db,1);Array.add(Sa,new l(wa.Span.Start,T.substring(wa.Span.Start,wa.Span.End),wa,!0))}this.cgc(Ca,db,Sa)}};e.prototype.Nwb=function(T,ua,ma){var wa=ua.getItem(T.toString());wa||(wa=this.colors[ua.count%this.colors.length],ua.add(T.toString(),wa));return String.format(wa,ma)};e.prototype.UQh=function(T,ua,ma,wa){T="["+T+", "+ua+"]";ua=ma.getItem(T);ua||(ua=ma.count%this.colors.length,ua=this.colors[ua],wa===String.format(ua,1)&&(ma.add("skip-"+
T,ua),ua=ma.count%this.colors.length,ua=this.colors[ua]),ma.add(T,ua));return String.format(ua,1)};e.prototype.FGa=function(T,ua,ma,wa,Ca){O.ULS.shipAssertTag(524039648,0,ma<=wa,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");ma<wa&&(ua=ua.substring(ma,wa),Array.add(T,Object.assign(new Ub.a,{text:ua,color:Ca})))};e.prototype.cgc=function(T,ua,ma){var wa=this;ma=void 0===ma?null:ma;T&&T.length?(O.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+
T.length),T.reverse(),ma.reverse(),this.gridView.Fb.ox(T,[3],!0,function(Ca,db){if(Ca&&Ca.range&&db){O.ULS.shipAssertTag(524039643,0,ua.xb(Ca.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Ca.range.toString());var Sa=wa.Nwb(Ca.range,ua,.1),hb=wa.Nwb(Ca.range,ua,1);wa.Qc.frame&&wa.Qc.frame.bI&&wa.Qc.frame.bI.Ila||(db.style.background=Sa);db.style.borderColor=hb;ma&&(db.setAttribute(nc.a.Czb,Ca.oaa.toString()),Ca.metadata=
ma[Ca.oaa])}else O.ULS.shipAssertTag(524039646,0,!!Ca,"ColoredReferencesManager.HighlightRanges: state is null"),O.ULS.shipAssertTag(524039645,0,!!Ca.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),O.ULS.shipAssertTag(524039644,0,!!db,"ColoredReferencesManager.HighlightRanges: div is null")})):(T=this.Qc.Sb.Hc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Fb.si([3]),this.gridView.Fb.RLb(new gc.a(null,this.gjd()),[3]),T.stop())};e.prototype.Ryj=function(T,ua,ma){var wa=
T.textBox;wa.VK=!0;var Ca=wa.selection,db=Ca.index;Ca=db+Ca.length;wa.setTextFromTextParts(ua);ua=wa.text.length;wa.selectRange(Math.min(db,ua),Math.min(Ca,ua));ma&&T.fIb(new Ha.a);wa.VK=!1};e.prototype.gjd=function(){return this.b5e().sheetId};e.prototype.c5e=function(){return this.b5e().sheetName};e.prototype.b5e=function(){return this.gridView.Lt&&this.gridView.Lt.CL?this.gridView.Lt.CL:this.Qc.oa};e.gKi="rgba(9, 134, 88, 1)";e.USg="rgba(0, 0, 255, 1)";e.HLj="rgba(163, 21, 21, 1)";Object(F.a)(e,
"ColoredReferencesManager",null,[636,3]);var Eb=ea.a;Am(c,Eb);c.prototype.create=function(){var T=this;this.$.da.Ya(266,function(ua){ua=Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ServiceInit",!1)?T.$.da.Aa(281)||T.$.da.Ha(281,new e(T.$,ua)):new e(T.$,ua);T.Eb(ua)})};c.ka=function(T){T.da.Ha(282,new c(T))};Object(F.a)(c,"ColoredReferencesManagerFactory",ea.a,[]);var Tb=b(1015),Wc=ea.a;Am(a,Wc);a.prototype.create=function(){var T=this;this.$.da.Ya(266,function(ua){ua=Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ServiceInit",
!1)?T.$.da.Aa(294)||T.$.da.Ha(294,new Tb.RelativeAndAbsoluteReferencesManager(ua)):new Tb.RelativeAndAbsoluteReferencesManager(ua);T.Eb(ua)})};a.ka=function(T){T.da.Ha(295,new a(T))};Object(F.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",ea.a,[]);Type.registerNamespace("_Ewa");z.a.Ga(C.ka);z.a.Ga(m.ka);z.a.Ga(c.ka);z.a.Ga(a.ka)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/bbb5da6cdca2c0ad555293ca2c8c5b4f/EwaDS.calc.js.map